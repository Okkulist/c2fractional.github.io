<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C¬≤ Fractional Management ‚Äî Quotation</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>üìä</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#f5f3f0}
input:focus,textarea:focus{outline:none;border-color:#333 !important}
button{cursor:pointer}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px}
.modal-box{background:#fff;border-radius:12px;padding:24px;max-width:600px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.2)}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const { useState, useMemo, useRef, useCallback } = React;

const PW = "aboshakraistheog";
const RATE = 1200;
const MIN_RETAINER = 100000;
const REV = 120000000;
const FX = 47;
const M1_CAP = 160;
const M1_FIREFIGHT = 80;

const D = { finance:{l:"Finance & Accounting",c:"#1e40af",bg:"#eff6ff",bdr:"#bfdbfe"}, ops:{l:"Operations & Commercial",c:"#92400e",bg:"#fffbeb",bdr:"#fde68a"}, hr:{l:"HR & People",c:"#7c3aed",bg:"#faf5ff",bdr:"#ddd6fe"}, deals:{l:"Deal Negotiations",c:"#0f766e",bg:"#f0fdfa",bdr:"#99f6e4"} };
const T = { quick:{l:"Quick Win",c:"#16653a",bg:"#f0fdf4",bdr:"#bbf7d0",tag:"#dcfce7",ico:"‚ö°"}, medium:{l:"Medium Win",c:"#a16207",bg:"#fefce8",bdr:"#fde68a",tag:"#fef9c3",ico:"üîß"}, moon:{l:"Moonshot",c:"#b91c1c",bg:"#fef2f2",bdr:"#fecaca",tag:"#fee2e2",ico:"üöÄ"} };
const IMP = { high:{l:"High",c:"#dc2626",n:3}, med:{l:"Medium",c:"#ea580c",n:2}, low:{l:"Low",c:"#ca8a04",n:1} };
const PRIO = {
  rev:{l:"Revenue",ico:"üìà",c:"#059669",bg:"#ecfdf5",bdr:"#6ee7b7",tag:"#d1fae5",short:"REV"},
  cost:{l:"Cost Reduction",ico:"‚úÇÔ∏è",c:"#dc2626",bg:"#fef2f2",bdr:"#fca5a5",tag:"#fee2e2",short:"COST"},
  cash:{l:"Cash Collection",ico:"üíµ",c:"#1e40af",bg:"#eff6ff",bdr:"#93c5fd",tag:"#dbeafe",short:"CASH"}
};
const PRIO_ORDER = {rev:0,cost:1,cash:2};

const BRANCHES = ["Korba","Mohandessin","Maadi","Zamalek","Nasr City","Heliopolis","New Cairo","6th of October"];
const MONTHS_LIST = ["Jan 2026","Feb 2026","Mar 2026","Apr 2026","May 2026","Jun 2026"];

// ‚ïê‚ïê‚ïê TASKS (B4 Gap Analysis removed) ‚ïê‚ïê‚ïê
const INITIAL_TASKS = [
  { id:1,b:"B1",name:"Consolidated P&L Report",dept:"finance",tier:"medium",hrs:10,w:[5,7],impact:"high",prio:"cost",desc:"Build the first consolidated P&L across all branches and central prep. Scheduled for end of March ‚Äî no opening stock exists, so we need a full month of controlled data before this is meaningful.",pnl:"Creates measurement system. Identifies 5‚Äì15% profit variance between branches.",bs:"First accurate balance sheet baseline. Corrects retained earnings.",cf:"Identifies cash vs. accrual gaps. Reveals where cash is trapped.",deps:[],enables:[2,7,8,14,15,16]},
  { id:2,b:"B1",name:"P&L per Branch",dept:"finance",tier:"medium",hrs:10,w:[5,7],impact:"high",prio:"cost",desc:"Break profitability to branch level. Requires consolidated P&L first ‚Äî also end of March due to missing opening stock.",pnl:"Exposes 5‚Äì15% profit variance. Enables targeted intervention on underperformers.",bs:"Identifies excess inventory and understated liabilities per branch.",cf:"Maps cash generation by location. Reveals cash-subsidised branches.",deps:[1],enables:[15,24,27]},
  { id:3,b:"B1",name:"Bank Statement Collection & Reconciliation",dept:"finance",tier:"quick",hrs:2,w:[1,1],impact:"med",prio:"cash",desc:"Gather all bank records for full reconciliation. Unreconciled accounts hide embezzlement, duplicate payments, missing deposits.",pnl:"Uncovers 1‚Äì3% unrecorded transactions distorting P&L.",bs:"Enables accurate cash position. Identifies unrecorded liabilities.",cf:"Foundation of cash flow accuracy. Gap between bank and book = pure risk.",deps:[],enables:[4,6]},
  { id:4,b:"B1",name:"Register All Transactions on System",dept:"finance",tier:"quick",hrs:6,w:[1,1],impact:"high",prio:"cash",desc:"Force every transaction through accounting. Off-book activity is the fastest path to cash leakage.",pnl:"Captures 2‚Äì5% unrecorded revenue. Eliminates invisible expenses.",bs:"Corrects AR/AP balances. Ensures all liabilities recognised.",cf:"Closes gap between actual and recorded cash flow.",deps:[3],enables:[1,6,13]},
  { id:5,b:"B1",name:"Fixed Assets Count (All Locations)",dept:"finance",tier:"quick",hrs:8,w:[1,2],impact:"med",prio:"cost",desc:"Physically verify every asset against register. Phantom assets inflate BS; unregistered assets have no insurance.",pnl:"Corrects depreciation by 5‚Äì15%. Removes ghost asset expenses.",bs:"Direct BS correction ‚Äî aligns book value to physical reality.",cf:"Eliminates over-depreciation cash drag. Identifies disposal proceeds.",deps:[],enables:[6]},
  { id:6,b:"B1",name:"Financial Position Statement",dept:"finance",tier:"medium",hrs:8,w:[5,7],impact:"high",prio:"cash",desc:"Definitive snapshot of what the business owns, owes, and is worth. Scheduled end of March ‚Äî requires reconciled bank statements and registered transactions to be meaningful.",pnl:"Validates P&L accuracy via BS cross-check.",bs:"This IS the balance sheet. First accurate snapshot ‚Äî possibly ever.",cf:"Derives cash flow statement from BS movements. Shows free cash flow.",deps:[1,3,4,5],enables:[]},
  { id:7,b:"B1",name:"2025 Budget vs. Actual Review",dept:"finance",tier:"quick",hrs:12,w:[1,2],impact:"med",prio:"cost",desc:"Compare budget to actual for 2025. Variances reveal broken assumptions and uncontrolled spending.",pnl:"Identifies 3‚Äì7% controllable cost overruns.",bs:"Reveals capex over/under budget.",cf:"Compares cash budget to actual cash position.",deps:[],enables:[15,16]},
  { id:8,b:"B1",name:"Food Costing & Recipe Pricing Audit",dept:"finance",tier:"quick",hrs:16,w:[1,3],impact:"high",prio:"cost",desc:"Visit every branch, measure actual recipes vs. system. The #1 margin lever ‚Äî wrong recipe costs = wrong menu prices.",pnl:"2‚Äì5 pp food cost reduction. On EGP 120M, that's EGP 2.4M‚Äì6M/year.",bs:"Corrects inventory valuation. Identifies obsolete stock.",cf:"Faster inventory turnover. Reduces cash trapped in excess stock 10‚Äì20%.",deps:[],enables:[12,21,25]},
  { id:12,b:"B2",name:"Menu Costing Full Review",dept:"finance",tier:"medium",hrs:12,w:[2,4],impact:"high",prio:"cost",desc:"Re-cost every menu item including sub-recipes, garnishes, packaging.",pnl:"2‚Äì4% gross margin improvement.",bs:"Corrects WIP inventory valuation.",cf:"Better margin = more cash per transaction.",deps:[8],enables:[24,25]},
  { id:13,b:"B2",name:"Full Stock Take (All Locations)",dept:"finance",tier:"medium",hrs:16,w:[2,3],impact:"high",prio:"cost",desc:"Physical count of every item in every location. Gap between book and physical = pure loss.",pnl:"1‚Äì3% COGS reduction from shrinkage control.",bs:"Direct inventory adjustment. May require write-down of damaged/obsolete stock.",cf:"Stops ongoing cash drain from pilferage.",deps:[4],enables:[14,16,23]},
  { id:15,b:"B2",name:"Revenue Analysis 2025/26 per Branch",dept:"finance",tier:"medium",hrs:12,w:[7,9],impact:"high",prio:"rev",desc:"Deep revenue trends by month, branch, category.",pnl:"3‚Äì8% revenue uplift from demand alignment.",bs:"Informs asset allocation decisions.",cf:"Reveals cash generation patterns by period.",deps:[1,2],enables:[26]},
  { id:16,b:"B2",name:"Detailed Expenses per Branch",dept:"finance",tier:"medium",hrs:12,w:[7,9],impact:"high",prio:"cost",desc:"Line-by-line expense breakdown per branch.",pnl:"5‚Äì12% cost reduction on outlier categories.",bs:"May reveal unrecorded liabilities.",cf:"Targets exact expense lines consuming excess cash.",deps:[1,2],enables:[]},
  { id:20,b:"B2",name:"Purchases Analysis 2026 Monthly",dept:"finance",tier:"medium",hrs:8,w:[3,5],impact:"med",prio:"cost",desc:"Analyse procurement patterns ‚Äî over-ordering, supplier pricing creep, purchasing inefficiencies.",pnl:"3‚Äì6% procurement savings.",bs:"Identifies excess inventory for liquidation.",cf:"Reduces cash tied in over-ordering.",deps:[],enables:[]},
  { id:21,b:"B2",name:"Staff Meal Treatment & Policy",dept:"finance",tier:"medium",hrs:4,w:[3,4],impact:"low",prio:"cost",desc:"Define staff meal rules and tracking.",pnl:"0.5‚Äì1.5% food cost reduction.",bs:"Reclassifies hidden cost. Improves inventory accuracy.",cf:"Reduces uncontrolled food consumption draining inventory cash.",deps:[8],enables:[28]},
  { id:9,b:"B3",name:"Menu Review & Optimisation",dept:"ops",tier:"quick",hrs:8,w:[1,2],impact:"high",prio:"rev",desc:"Analyse menu for dead items, cannibalisation, complexity.",pnl:"2‚Äì4% revenue uplift. 1‚Äì2% food cost reduction.",bs:"Reduces raw material SKUs ‚Üí lower inventory.",cf:"Faster inventory turns, fewer slow-moving items.",deps:[],enables:[8,10,22,24]},
  { id:10,b:"B3",name:"Pricing Structure Review",dept:"ops",tier:"quick",hrs:8,w:[1,2],impact:"high",prio:"rev",desc:"Audit every price against cost, competition, willingness-to-pay.",pnl:"1‚Äì3% revenue increase. Direct EBITDA improvement.",bs:"Pure income statement play. Improves retained earnings.",cf:"Immediate cash flow improvement.",deps:[9],enables:[22]},
  { id:14,b:"B3",name:"Random Inspection SOP",dept:"finance",tier:"medium",hrs:6,w:[2,3],impact:"med",prio:"cost",desc:"Formalise unannounced branch inspections ‚Äî cash, inventory, food safety.",pnl:"1‚Äì3% reduction in shrinkage and cash discrepancies.",bs:"Protects inventory asset value.",cf:"Prevents ongoing cash leakage at branch level.",deps:[13],enables:[16]},
  { id:22,b:"B3",name:"End-of-Month Inspection SOP",dept:"finance",tier:"medium",hrs:6,w:[2,3],impact:"med",prio:"cash",desc:"Standardise monthly close at branch level.",pnl:"Improves monthly P&L accuracy.",bs:"Ensures BS updated monthly, not annually.",cf:"Monthly cash reconciliation catches discrepancies early.",deps:[13],enables:[29]},
  { id:23,b:"B3",name:"Closing Procedures SOP",dept:"ops",tier:"medium",hrs:8,w:[2,4],impact:"med",prio:"cash",desc:"Standardise end-of-day: cash reconciliation, inventory logging, equipment, security.",pnl:"0.5‚Äì1% revenue protection from cash handling.",bs:"Protects daily cash asset.",cf:"EGP 500/day cash discrepancy = EGP 1.8M/year across branches.",deps:[13,14],enables:[29]},
  { id:24,b:"B3",name:"Sales Mix Report per Branch",dept:"ops",tier:"quick",hrs:10,w:[1,2],impact:"high",prio:"rev",desc:"Track what each branch sells, at what margin.",pnl:"1‚Äì3% margin improvement via menu engineering.",bs:"Informs inventory stocking decisions.",cf:"Higher-margin sales mix = more cash per cover.",deps:[],enables:[26]},
  { id:25,b:"B3",name:"Menu Items Guide (Prep Standards)",dept:"ops",tier:"moon",hrs:30,w:[3,11],impact:"med",prio:"cost",desc:"Full prep standards manual with photography of every plate.",pnl:"1‚Äì2% food cost reduction from portion control.",bs:"Improves inventory predictability.",cf:"Tighter portions = less cash consumed per dish.",deps:[8,12],enables:[]},
  { id:26,b:"B3",name:"Marketing Review & Plan",dept:"ops",tier:"medium",hrs:12,w:[3,6],impact:"med",prio:"rev",desc:"Audit marketing spend, channels, ROI.",pnl:"15‚Äì30% marketing ROI improvement.",bs:"Reclassifies marketing assets.",cf:"Reduces upfront marketing cash drain.",deps:[15,24],enables:[]},
  { id:27,b:"B3",name:"Discount Categories Audit & Policy",dept:"ops",tier:"medium",hrs:6,w:[3,4],impact:"med",prio:"rev",desc:"Review all discount types and authority.",pnl:"1‚Äì3% revenue recovery from capped discounting.",bs:"Pure revenue protection.",cf:"Recovered revenue flows directly to cash.",deps:[2],enables:[]},
  { id:28,b:"B3",name:"Staff Meal Menu & Punching System",dept:"ops",tier:"medium",hrs:6,w:[3,4],impact:"low",prio:"cost",desc:"Dedicated staff menu and tracking system.",pnl:"0.5‚Äì1% food cost reduction.",bs:"Corrects inventory accuracy.",cf:"Reduces invisible daily cash drain.",deps:[21],enables:[]},
  { id:29,b:"B5",name:"Daily/Weekly/Monthly Financial Reports",dept:"finance",tier:"moon",hrs:20,w:[8,11],impact:"high",prio:"cash",desc:"Complete financial reporting cadence. Daily flash catches revenue drops on Day 1.",pnl:"5‚Äì10% faster response to P&L deviations.",bs:"Monthly BS reporting ensures continuous accuracy.",cf:"Daily cash reporting. Weekly forecast accuracy: ¬±30% ‚Üí ¬±5%.",deps:[1,2,22],enables:[]},
  { id:33,b:"B5",name:"Daily/Weekly/Monthly Ops Reports",dept:"ops",tier:"moon",hrs:16,w:[7,10],impact:"high",prio:"rev",desc:"Operational reporting: covers, average check, complaints, wait times, waste.",pnl:"3‚Äì8% improvement across operational P&L lines.",bs:"Validates inventory and asset utilisation.",cf:"Efficiency gains reduce daily cash burn.",deps:[2,23,24],enables:[]},
  { id:11,b:"B5",name:"HR Structure, Policies & JD Review",dept:"hr",tier:"quick",hrs:14,w:[1,2],impact:"med",prio:"cost",desc:"Consolidate HR review: policies, job descriptions, org chart.",pnl:"5‚Äì10% labour reallocation opportunity.",bs:"Enables restructuring that reduces liability provisions.",cf:"Identifies overstaffing cash drain.",deps:[],enables:[30,31]},
  { id:30,b:"B5",name:"Salaries, Scale & Evaluations Review",dept:"hr",tier:"medium",hrs:14,w:[2,4],impact:"high",prio:"cost",desc:"Benchmark compensation vs. market.",pnl:"3‚Äì8% labour cost optimisation.",bs:"May reveal unrecorded payroll liabilities.",cf:"Right-sizing payroll = immediate monthly cash savings.",deps:[11],enables:[31,32]},
  { id:31,b:"B5",name:"Policies & Procedures Manual",dept:"hr",tier:"moon",hrs:40,w:[6,11],impact:"high",prio:"cost",desc:"The operating bible ‚Äî standardises every process across all departments.",pnl:"5‚Äì12% OpEx reduction from process standardisation.",bs:"Reduces contingent liabilities from compliance gaps.",cf:"Eliminates emergency spending and unplanned costs.",deps:[11,30],enables:[32]},
  { id:32,b:"B5",name:"Job Descriptions (All Roles)",dept:"hr",tier:"moon",hrs:30,w:[6,11],impact:"high",prio:"cost",desc:"Role-specific JDs with KPIs and accountability.",pnl:"3‚Äì6% labour cost reduction.",bs:"Supports restructuring provisions.",cf:"Permanently lower monthly payroll outflow.",deps:[11,30],enables:[]},
  { id:36,b:"B1",name:"Accrued Revenue Collection from Branches",dept:"finance",tier:"quick",hrs:8,w:[1,2],impact:"high",prio:"cash",desc:"Identify and collect all accrued but uncollected revenues from branches.",pnl:"Recovers 1‚Äì4% of branch revenue previously unrecorded.",bs:"Converts accrued revenue asset into cash.",cf:"Immediate cash injection. On EGP 120M, even 1% = EGP 1.2M.",deps:[3,4],enables:[1,2,6]},
  { id:37,b:"B5",name:"Redundant Headcount Reduction",dept:"hr",tier:"quick",hrs:10,w:[1,3],impact:"high",prio:"cost",desc:"Identify and action redundant, duplicated, or unproductive roles.",pnl:"5‚Äì12% labour cost reduction on targeted roles.",bs:"Reduces accrued payroll liabilities.",cf:"Permanent monthly cash saving ‚Äî immediate impact.",deps:[11],enables:[30,31,32]},
  { id:34,b:"B6",name:"Deal / Contract Analysis & Assessment",dept:"deals",tier:"medium",hrs:40,w:[1,4],impact:"high",prio:"cash",desc:"Deep analysis: financial terms, obligations, risk allocation, benchmarking.",pnl:"Prevents unfavourable terms costing 5‚Äì15% of deal value.",bs:"Assesses BS impact: lease obligations, guarantees, earnouts.",cf:"Models full cash flow implications: upfront, ongoing, exit costs.",deps:[],enables:[35]},
  { id:35,b:"B6",name:"Deal Negotiation & Counter-Proposal",dept:"deals",tier:"medium",hrs:40,w:[5,8],impact:"high",prio:"cash",desc:"Negotiation strategy, counter-proposals, protect financial interests.",pnl:"Improved terms protect long-term P&L.",bs:"Negotiated terms affect long-term liabilities.",cf:"Better payment terms improve cash.",deps:[34],enables:[]},
  { id:38,b:"B6",name:"Quick Commerce Renegotiation & New Deals",dept:"deals",tier:"quick",hrs:24,w:[1,4],impact:"high",prio:"rev",desc:"Renegotiate existing quick commerce agreements (Talabat, Noon, etc.).",pnl:"1‚Äì3pp commission reduction = EGP 1.2M‚Äì3.6M/year.",bs:"Reduces accrued platform liabilities.",cf:"Shorter settlement cycles inject cash faster.",deps:[],enables:[35]},
];

const milestoneFees = [
  { id:"S1",milestone:"EBITDA reaches breakeven (0%)",current:"Negative EBITDA",target:"0% EBITDA margin",saving:"EGP 2.4M‚Äì6M (depending on current deficit)",fee:300000,feeLabel:"EGP 300K",color:"#16653a",icon:"üéØ",how:"Monthly P&L shows EBITDA ‚â• 0 for 2 consecutive months, verified jointly." },
  { id:"S2",milestone:"EBITDA reaches 5% of revenue",current:"0% EBITDA",target:"5% = EGP 6M/year",saving:"EGP 6M annual profit created",fee:500000,feeLabel:"EGP 500K",color:"#1e40af",icon:"üìà",how:"Trailing 3-month average EBITDA ‚â• 5% of revenue, verified from audited P&L." },
  { id:"S3",milestone:"EBITDA reaches 10% of revenue",current:"5% EBITDA",target:"10% = EGP 12M/year",saving:"EGP 6M additional annual profit",fee:750000,feeLabel:"EGP 750K",color:"#7c3aed",icon:"üöÄ",how:"Trailing 3-month average EBITDA ‚â• 10%. This is the well-run F&B benchmark." },
  { id:"S4",milestone:"Food cost reduced by ‚â• 2pp",current:"Est. 36‚Äì40%",target:"34‚Äì38% or lower",saving:"Each point = EGP 1.2M/year on EGP 120M",fee:200000,feeLabel:"EGP 200K/point",color:"#a16207",icon:"üçΩ",how:"Trailing 3-month average food cost % vs. Month 1 baseline." },
  { id:"S5",milestone:"Revenue recovery (off-book captured)",current:"Unknown leakage",target:"Captured & recorded",saving:"Typically 2‚Äì5% of revenue = EGP 2.4M‚Äì6M",fee:0,feeLabel:"3% of recovered",color:"#dc2626",icon:"üí∞",how:"Total verified unrecorded revenue identified through reconciliation." },
  { id:"S6",milestone:"Shrinkage reduced below 1.5%",current:"Est. 3‚Äì5%",target:"‚â§ 1.5% of purchases",saving:"1.5% on ~EGP 45M = EGP 675K",fee:0,feeLabel:"5% of savings",color:"#be185d",icon:"üì¶",how:"Pre-engagement shrinkage (first stock take) vs. Month 6 stock take." },
];

const marketComp = [
  { provider:"Big 4 Advisory (Deloitte / EY)",monthly:"EGP 450K‚Äì750K",total:"EGP 2.7M‚Äì4.5M",success:"None",verdict:"Overkill for single-brand F&B. Generic frameworks. You pay for the brand.",score:2 },
  { provider:"Regional F&B Consultancy",monthly:"EGP 150K‚Äì300K",total:"EGP 450K‚Äì900K",success:"Rare (5‚Äì10%)",verdict:"Strong on concept/menu but weak on financial controls and system gap analysis.",score:3 },
  { provider:"Freelance F&B Consultant (Egypt)",monthly:"EGP 120K‚Äì200K",total:"EGP 240K‚Äì600K",success:"None",verdict:"Expensive per output. No financial depth ‚Äî no P&L, no bank reconciliation, no gap analysis.",score:2 },
  { provider:"Fractional CFO (International)",monthly:"EGP 140K‚Äì470K",total:"EGP 1.7M‚Äì5.6M/yr",success:"Rare (0‚Äì5%)",verdict:"Strong finance but zero F&B ops. Won't audit recipes or run stock takes.",score:2 },
  { provider:"C¬≤ Fractional Management",monthly:"EGP 192K (M1) ‚Üí 100K+",total:"EGP 700K‚Äì750K",success:"EBITDA milestones",verdict:"Full-scope: finance + ops + HR + deals. M1 includes 80h firefighting + 80h structured deliverables. Success fees only on verified P&L improvement.",score:5 },
];

const requirements = [
  { item:"Full access to accounting system & chart of accounts",who:"CFO / Finance team",due:"Day 1",critical:true },
  { item:"Bank statements ‚Äî all accounts, last 24 months",who:"CFO / Finance team",due:"Day 1",critical:true },
  { item:"All supplier contracts & outstanding invoices",who:"Procurement lead",due:"Day 1",critical:true },
  { item:"POS sales data export ‚Äî all branches, last 12 months",who:"IT / Branch managers",due:"Day 1",critical:true },
  { item:"Payroll records & org chart (all entities)",who:"HR lead",due:"Day 1",critical:true },
  { item:"All existing deal contracts (QC platforms, partners, leases)",who:"Legal / Management",due:"Day 1",critical:true },
  { item:"Branch manager availability for stock take (2‚Äì3 hrs each)",who:"Branch managers",due:"Week 1‚Äì2",critical:true },
  { item:"Food costing system access or raw recipe data",who:"Kitchen / Ops lead",due:"Week 1",critical:true },
  { item:"Fixed asset register (or best available list)",who:"Finance team",due:"Week 1",critical:false },
  { item:"2025 budget file (Excel or system export)",who:"CFO",due:"Week 1",critical:false },
  { item:"All inter-branch settlement records & cash transfer logs",who:"Finance team",due:"Week 1",critical:false },
  { item:"HR files: contracts, job grades, evaluation history",who:"HR lead",due:"Week 2",critical:false },
  { item:"Marketing spend breakdown & campaign history",who:"Marketing / Management",due:"Week 2",critical:false },
  { item:"Dedicated internal point-of-contact (min. 10 hrs/week availability)",who:"Management",due:"Ongoing",critical:true },
];

// Buckets without B4
const buckets = [
  { id:"B1",name:"Financial Visibility & Controls",color:"#1e40af",bg:"#eff6ff",bdr:"#bfdbfe",ico:"üìä",tier:"quick",weeks:"1‚Äì7",primaryPrio:"cost",impactPills:[{p:"cash",v:"EGP 1.2M+",l:"Accrued collections"},{p:"cost",v:"EGP 3‚Äì8M",l:"Food & asset cost fix"},{p:"rev",v:"2‚Äì5%",l:"Unrecorded revenue"}],desc:"Establish the financial scoreboard. Bank reconciliation, transaction registration, food cost audit, and budget review begin immediately (W1‚Äì2). Consolidated P&L, branch P&L, and financial position scheduled for end of March ‚Äî no opening stock exists, so meaningful financials require a full month of controlled data." },
  { id:"B2",name:"Cost & Revenue Deep-Dive",color:"#a16207",bg:"#fffbeb",bdr:"#fde68a",ico:"üîç",tier:"medium",weeks:"2‚Äì9",primaryPrio:"cost",impactPills:[{p:"cost",v:"EGP 450K‚Äì1.35M",l:"Shrinkage control"},{p:"cost",v:"5‚Äì12%",l:"Branch expense cuts"},{p:"rev",v:"3‚Äì8%",l:"Revenue uplift"}],desc:"Stock take, menu costing, and purchases analysis begin immediately (W2‚Äì5). Deep revenue and expense analysis per branch follows once end-of-March P&L data is available (W7‚Äì9)." },
  { id:"B3",name:"Operational SOPs & Controls",color:"#16653a",bg:"#f0fdf4",bdr:"#bbf7d0",ico:"‚öôÔ∏è",tier:"medium",weeks:"1‚Äì11",primaryPrio:"rev",impactPills:[{p:"rev",v:"EGP 1.2‚Äì6M",l:"Pricing & menu uplift"},{p:"rev",v:"1‚Äì3%",l:"Discount recovery"},{p:"cash",v:"EGP 1.8M/yr",l:"Daily cash leakage stopped"}],desc:"Translate financial findings into daily operational discipline. Sales mix report and menu/pricing reviews are immediate quick wins (W1‚Äì2). SOPs, inspections, and marketing follow (W2‚Äì6)." },
  { id:"B5",name:"Reporting & Sustainability",color:"#7c3aed",bg:"#faf5ff",bdr:"#ddd6fe",ico:"üìà",tier:"moon",weeks:"1‚Äì11",primaryPrio:"cost",impactPills:[{p:"cost",v:"EGP 120K+/yr",l:"Per redundant headcount removed"},{p:"cost",v:"3‚Äì8%",l:"Labour optimisation"},{p:"rev",v:"3‚Äì8%",l:"Ops P&L improvement"}],desc:"Reporting cadences, P&P manual, JDs, HR restructuring. The infrastructure that makes improvements permanent and creates accountability at every level." },
  { id:"B6",name:"Deal Negotiations",color:"#0f766e",bg:"#f0fdfa",bdr:"#99f6e4",ico:"ü§ù",tier:"medium",weeks:"1‚Äì8",primaryPrio:"rev",impactPills:[{p:"rev",v:"EGP 1.2‚Äì3.6M/yr",l:"QC commission savings"},{p:"cash",v:"Faster",l:"Settlement cycles"},{p:"cash",v:"5‚Äì15%",l:"Deal value protected"}],desc:"Separate parallel track: counter-party deal analysis and negotiation. Month 1 = due diligence & risk mapping. Month 2 = negotiation strategy & term sheet." },
];

const WEEKS=[1,2,3,4,5,6,7,8,9,10,11,12];
const mono="'DM Mono',monospace",sans="'DM Sans','Segoe UI',sans-serif",disp="'Outfit',sans-serif";

function computeMonthly(taskList) {
  const months=[{w:[1,4],label:"Month 1",wks:"W1‚ÄìW4"},{w:[5,8],label:"Month 2",wks:"W5‚ÄìW8"},{w:[9,12],label:"Month 3",wks:"W9‚ÄìW12"}];
  return months.map((m,mi)=>{
    const hrs=taskList.reduce((sum,t)=>{
      const span=t.w[1]-t.w[0]+1; let ov=0;
      for(let w=m.w[0];w<=m.w[1];w++) if(w>=t.w[0]&&w<=t.w[1]) ov++;
      return sum+(t.hrs*ov/span);
    },0);
    const roundH=Math.round(hrs);
    const deliverableHrs = mi===0 ? Math.min(roundH, M1_CAP - M1_FIREFIGHT) : roundH;
    const firefightHrs = mi===0 ? M1_FIREFIGHT : 0;
    const totalHrs = mi===0 ? M1_CAP : roundH;
    const computed=totalHrs*RATE;
    const retainer=Math.max(computed,MIN_RETAINER);
    const tks=taskList.filter(t=>{for(let w=m.w[0];w<=m.w[1];w++) if(w>=t.w[0]&&w<=t.w[1]) return true; return false;});
    return {...m,hrs:totalHrs,deliverableHrs,firefightHrs,computed,retainer,tasks:tks,isFloor:computed<MIN_RETAINER};
  });
}

function prioSort(a,b){
  if(PRIO_ORDER[a.prio]!==PRIO_ORDER[b.prio]) return PRIO_ORDER[a.prio]-PRIO_ORDER[b.prio];
  const impOrd={high:0,med:1,low:2},tierOrd={quick:0,medium:1,moon:2};
  if(impOrd[a.impact]!==impOrd[b.impact]) return impOrd[a.impact]-impOrd[b.impact];
  return tierOrd[a.tier]-tierOrd[b.tier];
}

// ‚ïê‚ïê‚ïê EXCEL EXPORT ‚ïê‚ïê‚ïê
function exportToExcel(tasks, opsMonthly, dealMonthly, budgetData, comments) {
  const wb = XLSX.utils.book_new();

  // Sheet 1: Tasks
  const taskRows = [["#","Bucket","Task Name","Department","Tier","Hours","Week Start","Week End","Impact","Priority","Description","P&L Impact","Balance Sheet","Cash Flow"]];
  tasks.forEach(t => {
    taskRows.push([t.id,t.b,t.name,D[t.dept]?.l||t.dept,T[t.tier]?.l||t.tier,t.hrs,t.w[0],t.w[1],IMP[t.impact]?.l||t.impact,PRIO[t.prio]?.l||t.prio,t.desc,t.pnl,t.bs,t.cf]);
  });
  const ws1 = XLSX.utils.aoa_to_sheet(taskRows);
  ws1['!cols'] = [{wch:5},{wch:6},{wch:35},{wch:20},{wch:12},{wch:8},{wch:10},{wch:10},{wch:8},{wch:15},{wch:50},{wch:40},{wch:40},{wch:40}];
  XLSX.utils.book_append_sheet(wb, ws1, "Tasks");

  // Sheet 2: Monthly Pricing
  const priceRows = [["Month","Weeks","Active Tasks","Total Hours","Rate (EGP)","Computed (EGP)","Retainer (EGP)","Notes"]];
  [...opsMonthly, ...dealMonthly.filter(m=>m.hrs>0)].forEach((m,i) => {
    priceRows.push([m.label+(i>=3?" (Deals)":""),m.wks,m.tasks.length,m.hrs,RATE,m.computed,m.retainer,m.isFloor?"Minimum retainer applies":""]);
  });
  const ws2 = XLSX.utils.aoa_to_sheet(priceRows);
  ws2['!cols'] = [{wch:15},{wch:10},{wch:14},{wch:14},{wch:14},{wch:18},{wch:18},{wch:30}];
  XLSX.utils.book_append_sheet(wb, ws2, "Monthly Pricing");

  // Sheet 3: Budget vs Actual
  const budRows = [["Branch","Month","Revenue Forecast","Revenue Actual","Revenue Variance","Food Cost Forecast","Food Cost Actual","Food Cost Variance","Labour Forecast","Labour Actual","Labour Variance","EBITDA Forecast","EBITDA Actual","EBITDA Variance"]];
  if(budgetData && budgetData.length>0) {
    budgetData.forEach(row => {
      budRows.push([row.branch,row.month,row.revF,row.revA,row.revA-row.revF,row.fcF,row.fcA,row.fcA-row.fcF,row.labF,row.labA,row.labA-row.labF,row.ebitdaF,row.ebitdaA,row.ebitdaA-row.ebitdaF]);
    });
  }
  const ws3 = XLSX.utils.aoa_to_sheet(budRows);
  ws3['!cols'] = Array(14).fill({wch:20});
  XLSX.utils.book_append_sheet(wb, ws3, "Budget vs Actual");

  // Sheet 4: Comments & Tasks
  const commRows = [["Date","Author","Type","Content","Related Task","Status"]];
  (comments||[]).forEach(c => {
    commRows.push([c.date,c.author,c.type,c.content,c.task||"",c.status||"Open"]);
  });
  const ws4 = XLSX.utils.aoa_to_sheet(commRows);
  ws4['!cols'] = [{wch:20},{wch:20},{wch:15},{wch:60},{wch:30},{wch:12}];
  XLSX.utils.book_append_sheet(wb, ws4, "Comments & Notes");

  XLSX.writeFile(wb, "C2_Abou_Shakra_Dashboard.xlsx");
}

// ‚ïê‚ïê‚ïê BUDGET INITIAL DATA ‚ïê‚ïê‚ïê
function mkBudgetRow(branch, month) {
  return { id:`${branch}-${month}`, branch, month, revF:"", revA:"", fcF:"", fcA:"", labF:"", labA:"", ebitdaF:"", ebitdaA:"" };
}

const App = function App(){
  const [authed,setAuthed]=useState(false),[pw,setPw]=useState(""),[pwErr,setPwErr]=useState(false);
  const [view,setView]=useState("overview");
  const [expBucket,setExpBucket]=useState(null),[expTask,setExpTask]=useState(null),[expFee,setExpFee]=useState(null);
  const [tasks,setTasks]=useState(INITIAL_TASKS);
  const [comments,setComments]=useState([]);
  const [showAddTask,setShowAddTask]=useState(false);
  const [showAddComment,setShowAddComment]=useState(false);
  const [budgetData,setBudgetData]=useState([]);
  const [budgetBranch,setBudgetBranch]=useState(BRANCHES[0]);
  const [budgetMonth,setBudgetMonth]=useState(MONTHS_LIST[0]);
  const [editingBudget,setEditingBudget]=useState(null);
  const [taskFilter,setTaskFilter]=useState("all");
  const [commentFilter,setCommentFilter]=useState("all");

  // New task form
  const [newTask,setNewTask]=useState({name:"",dept:"finance",tier:"quick",hrs:4,w:[1,4],impact:"med",prio:"cost",b:"B1",desc:"",pnl:"",bs:"",cf:""});
  // New comment form
  const [newComment,setNewComment]=useState({author:"",type:"comment",content:"",task:"",status:"Open"});

  const opsTasks=useMemo(()=>tasks.filter(t=>t.b!=="B6"),[tasks]);
  const dealTasks=useMemo(()=>tasks.filter(t=>t.b==="B6"),[tasks]);
  const opsMonthly=useMemo(()=>computeMonthly(opsTasks),[opsTasks]);
  const dealMonthly=useMemo(()=>computeMonthly(dealTasks),[dealTasks]);
  const opsTotal=opsMonthly.reduce((s,m)=>s+m.retainer,0);
  const dealTotal=dealMonthly.filter(m=>m.hrs>0).reduce((s,m)=>s+m.retainer,0);
  const grandTotal=opsTotal+dealTotal;

  const handleLogin=()=>{if(pw===PW){setAuthed(true);setPwErr(false)}else setPwErr(true)};

  const addTask=()=>{
    const id=Math.max(...tasks.map(t=>t.id))+1;
    setTasks(prev=>[...prev,{...newTask,id,deps:[],enables:[]}]);
    setNewTask({name:"",dept:"finance",tier:"quick",hrs:4,w:[1,4],impact:"med",prio:"cost",b:"B1",desc:"",pnl:"",bs:"",cf:""});
    setShowAddTask(false);
  };

  const addComment=()=>{
    const c={...newComment,id:Date.now(),date:new Date().toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})};
    setComments(prev=>[c,...prev]);
    setNewComment({author:"",type:"comment",content:"",task:"",status:"Open"});
    setShowAddComment(false);
  };

  const updateBudget=(id,field,val)=>{
    setBudgetData(prev=>prev.map(r=>r.id===id?{...r,[field]:val}:r));
  };

  const addBudgetRow=()=>{
    const key=`${budgetBranch}-${budgetMonth}`;
    if(budgetData.find(r=>r.id===key)) return;
    setBudgetData(prev=>[...prev,mkBudgetRow(budgetBranch,budgetMonth)]);
  };

  const deleteBudgetRow=(id)=>setBudgetData(prev=>prev.filter(r=>r.id!==id));

  const deleteTask=(id)=>setTasks(prev=>prev.filter(t=>t.id!==id));
  const deleteComment=(id)=>setComments(prev=>prev.filter(c=>c.id!==id));
  const toggleCommentStatus=(id)=>setComments(prev=>prev.map(c=>c.id===id?{...c,status:c.status==="Open"?"Resolved":"Open"}:c));

  // ‚îÄ‚îÄ‚îÄ BUDGET P&L NUMBERS (hooks must be before any conditional return) ‚îÄ‚îÄ‚îÄ
  const budgetTotals = useMemo(()=>{
    const totRevF=budgetData.reduce((s,r)=>s+(Number(r.revF)||0),0);
    const totRevA=budgetData.reduce((s,r)=>s+(Number(r.revA)||0),0);
    const totFcA=budgetData.reduce((s,r)=>s+(Number(r.fcA)||0),0);
    const totLabA=budgetData.reduce((s,r)=>s+(Number(r.labA)||0),0);
    const totEbitdaA=totRevA-totFcA-totLabA;
    const totEbitdaF=budgetData.reduce((s,r)=>s+(Number(r.revF)||0)-(Number(r.fcF)||0)-(Number(r.labF)||0),0);
    return [
      {l:"TOTAL FORECAST REV",v:totRevF.toLocaleString(),c:"#bbb"},
      {l:"TOTAL ACTUAL REV",v:totRevA.toLocaleString(),c:"#D4863A"},
      {l:"TOTAL EBITDA (F)",v:totEbitdaF.toLocaleString(),c:"#93c5fd"},
      {l:"TOTAL EBITDA (A)",v:totEbitdaA.toLocaleString(),c:totEbitdaA>0?"#4ade80":"#f87171"},
    ];
  },[budgetData]);

  const budgetSummary = useMemo(()=>{
    const summary={};
    BRANCHES.forEach(b=>{
      summary[b]={revF:0,revA:0,fcF:0,fcA:0,labF:0,labA:0,ebitdaF:0,ebitdaA:0,count:0};
    });
    budgetData.forEach(row=>{
      const s=summary[row.branch];
      if(!s) return;
      s.revF+=Number(row.revF)||0; s.revA+=Number(row.revA)||0;
      s.fcF+=Number(row.fcF)||0; s.fcA+=Number(row.fcA)||0;
      s.labF+=Number(row.labF)||0; s.labA+=Number(row.labA)||0;
      s.ebitdaF+=Number(row.ebitdaF)||0; s.ebitdaA+=Number(row.ebitdaA)||0;
      s.count++;
    });
    return summary;
  },[budgetData]);

  if(!authed) return(
    <div style={{fontFamily:sans,background:"#f5f3f0",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"}}>
      <div style={{textAlign:"center",maxWidth:380}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:3,marginBottom:24}}>
          <span style={{fontFamily:disp,fontSize:38,fontWeight:300,color:"#333"}}>C</span><span style={{fontFamily:disp,fontSize:26,fontWeight:300,color:"#333",position:"relative",top:-10}}>^</span><span style={{fontFamily:disp,fontSize:38,fontWeight:300,color:"#333"}}>2</span>
          <div style={{width:1,height:28,background:"#ccc",margin:"0 10px"}}/><span style={{fontFamily:disp,fontSize:11,color:"#999",letterSpacing:4,textTransform:"uppercase"}}>Fractional Management</span>
        </div>
        <p style={{fontSize:13,color:"#888",marginBottom:28}}>Abou Shakra ‚Äî Confidential Quotation</p>
        <div style={{background:"#fff",borderRadius:12,padding:"28px 24px",boxShadow:"0 1px 4px rgba(0,0,0,0.06)",border:"1px solid #e5e1dc"}}>
          <div style={{fontFamily:mono,fontSize:10,color:"#999",letterSpacing:1.5,marginBottom:12}}>ENTER PASSWORD</div>
          <input type="password" value={pw} onChange={e=>{setPw(e.target.value);setPwErr(false)}} onKeyDown={e=>e.key==="Enter"&&handleLogin()} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style={{width:"100%",padding:"12px 14px",border:pwErr?"1.5px solid #dc2626":"1.5px solid #ddd",borderRadius:8,fontSize:14,fontFamily:mono,background:"#fafaf8",boxSizing:"border-box"}}/>
          {pwErr&&<div style={{color:"#dc2626",fontSize:12,marginTop:6}}>Incorrect password</div>}
          <button onClick={handleLogin} style={{width:"100%",marginTop:14,padding:"11px",background:"#333",color:"#fff",border:"none",borderRadius:8,fontSize:13,fontWeight:700,fontFamily:sans}}>Access Dashboard</button>
        </div>
        <p style={{fontFamily:mono,fontSize:9,color:"#bbb",marginTop:16}}>QT-AS-2026-001 ¬∑ Confidential</p>
      </div>
    </div>
  );

  // ‚îÄ‚îÄ‚îÄ TASK CARD ‚îÄ‚îÄ‚îÄ
  const TaskCard=({t})=>{
    const tier=T[t.tier],dept=D[t.dept],imp=IMP[t.impact],pr=PRIO[t.prio],isOpen=expTask===t.id;
    const depT=t.deps.map(d=>tasks.find(x=>x.id===d)).filter(Boolean);
    const enT=(t.enables||[]).map(d=>tasks.find(x=>x.id===d)).filter(Boolean);
    const isCustom=t.id>100;
    return(
      <div onClick={()=>setExpTask(isOpen?null:t.id)} style={{background:"#fff",border:isOpen?`1.5px solid ${dept.c}40`:"1px solid #eee",borderRadius:8,padding:"9px 12px",cursor:"pointer",borderLeft:`3px solid ${pr.c}`,marginBottom:3}}>
        <div style={{display:"flex",alignItems:"center",gap:6}}>
          <span style={{fontFamily:mono,fontSize:9,color:"#ccc",width:18,textAlign:"right",flexShrink:0}}>#{t.id}</span>
          <div style={{flex:1,minWidth:0}}>
            <div style={{fontSize:11.5,fontWeight:700,color:"#222"}}>{t.name}{isCustom&&<span style={{marginLeft:5,fontFamily:mono,fontSize:7.5,color:"#7c3aed",background:"#faf5ff",padding:"1px 4px",borderRadius:2}}>CUSTOM</span>}</div>
            <div style={{display:"flex",gap:4,marginTop:2,alignItems:"center",flexWrap:"wrap"}}>
              <span style={{fontFamily:mono,fontSize:7.5,color:pr.c,background:pr.tag,padding:"1px 5px",borderRadius:2,fontWeight:700}}>{pr.ico} {pr.short}</span>
              <span style={{fontFamily:mono,fontSize:8,color:tier.c,background:tier.tag,padding:"1px 5px",borderRadius:2}}>{tier.ico} {tier.l}</span>
              <span style={{fontFamily:mono,fontSize:8,color:"#999"}}>W{t.w[0]}{t.w[1]!==t.w[0]?`‚Äì${t.w[1]}`:""} ¬∑ {t.hrs}h ¬∑ EGP {(t.hrs*RATE).toLocaleString()}</span>
            </div>
          </div>
          <div style={{display:"flex",gap:2,flexShrink:0}}>{[1,2,3].map(i=><div key={i} style={{width:3,height:9,borderRadius:1,background:i<=imp.n?imp.c:"#ddd"}}/>)}</div>
          {isCustom&&<button onClick={e=>{e.stopPropagation();deleteTask(t.id)}} style={{background:"#fee2e2",border:"none",borderRadius:3,padding:"2px 5px",fontSize:9,color:"#dc2626",fontFamily:mono}}>‚úï</button>}
          <span style={{fontSize:9,color:"#bbb",transform:isOpen?"rotate(180deg)":"",transition:"0.15s"}}>‚ñæ</span>
        </div>
        {isOpen&&<div style={{marginTop:8,paddingTop:8,borderTop:"1px solid #f0f0ee"}} onClick={e=>e.stopPropagation()}>
          <p style={{fontSize:11,color:"#555",lineHeight:1.6,margin:"0 0 8px",paddingLeft:24}}>{t.desc}</p>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,paddingLeft:24,marginBottom:6}}>
            <div style={{background:"#eff6ff",borderRadius:5,padding:"6px 8px",border:"1px solid #dbeafe"}}>
              <div style={{fontFamily:mono,fontSize:7,color:"#1e40af",letterSpacing:1,marginBottom:2}}>üìä P&L</div>
              <div style={{fontSize:9.5,color:"#1e40af",lineHeight:1.5}}>{t.pnl}</div>
            </div>
            <div style={{background:"#f0fdf4",borderRadius:5,padding:"6px 8px",border:"1px solid #bbf7d0"}}>
              <div style={{fontFamily:mono,fontSize:7,color:"#16653a",letterSpacing:1,marginBottom:2}}>üè¶ BAL. SHEET</div>
              <div style={{fontSize:9.5,color:"#16653a",lineHeight:1.5}}>{t.bs}</div>
            </div>
            <div style={{background:"#fefce8",borderRadius:5,padding:"6px 8px",border:"1px solid #fde68a"}}>
              <div style={{fontFamily:mono,fontSize:7,color:"#a16207",letterSpacing:1,marginBottom:2}}>üíµ CASH FLOW</div>
              <div style={{fontSize:9.5,color:"#a16207",lineHeight:1.5}}>{t.cf}</div>
            </div>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,paddingLeft:24}}>
            <div style={{background:"#fafaf8",borderRadius:5,padding:"5px 8px",border:"1px solid #eee"}}>
              <div style={{fontFamily:mono,fontSize:7,color:"#999",letterSpacing:1,marginBottom:2}}>‚¨Ü DEPENDS ON ({depT.length})</div>
              {depT.length===0?<div style={{fontSize:9,color:"#ccc"}}>No dependencies</div>:depT.map(d=><div key={d.id} style={{fontSize:9,color:"#666"}}>#{d.id} {d.name}</div>)}
            </div>
            <div style={{background:"#eff6ff",borderRadius:5,padding:"5px 8px",border:"1px solid #dbeafe"}}>
              <div style={{fontFamily:mono,fontSize:7,color:"#1e40af",letterSpacing:1,marginBottom:2}}>‚¨á ENABLES ({enT.length})</div>
              {enT.length===0?<div style={{fontSize:9,color:"#93c5fd"}}>Terminal deliverable</div>:enT.map(d=><div key={d.id} style={{fontSize:9,color:"#1e40af"}}>#{d.id} {d.name}</div>)}
            </div>
          </div>
        </div>}
      </div>
    );
  };

  const inputStyle={width:"100%",padding:"5px 7px",border:"1px solid #ddd",borderRadius:4,fontSize:11,fontFamily:mono,background:"#fafaf8"};
  const labelStyle={fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1,marginBottom:3};

  return(
    <div style={{fontFamily:sans,background:"#f5f3f0",color:"#333",minHeight:"100vh"}}>
      {/* HEADER */}
      <div style={{background:"#fff",borderBottom:"1px solid #e5e1dc",padding:"16px 24px 12px"}}>
        <div style={{maxWidth:1100,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:10}}>
          <div>
            <div style={{display:"flex",alignItems:"center",gap:3,marginBottom:6}}>
              <span style={{fontFamily:disp,fontSize:22,fontWeight:300}}>C</span><span style={{fontFamily:disp,fontSize:15,fontWeight:300,position:"relative",top:-5}}>^</span><span style={{fontFamily:disp,fontSize:22,fontWeight:300}}>2</span>
              <div style={{width:1,height:16,background:"#ddd",margin:"0 6px"}}/><span style={{fontFamily:disp,fontSize:9,color:"#999",letterSpacing:3,textTransform:"uppercase"}}>Fractional Management</span>
            </div>
            <h1 style={{fontFamily:disp,fontSize:18,fontWeight:700,color:"#1a1a1a",margin:"0 0 2px"}}>Abou Shakra ‚Äî F&B Financial Turnaround</h1>
            <p style={{fontFamily:mono,fontSize:9.5,color:"#aaa",margin:0}}>QT-AS-2026-001 ¬∑ Feb 2026 ¬∑ Valid 30 days</p>
          </div>
          <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
            <div style={{textAlign:"right"}}>
              <div style={{fontFamily:mono,fontSize:8,color:"#bbb",letterSpacing:1}}>ANNUAL REVENUE</div>
              <div style={{fontFamily:disp,fontSize:22,fontWeight:800,lineHeight:1}}>EGP 120M</div>
              <div style={{fontFamily:mono,fontSize:9,color:"#dc2626",fontWeight:600}}>Current EBITDA: Negative</div>
            </div>
            <button onClick={()=>exportToExcel(tasks,opsMonthly,dealMonthly,budgetData,comments)} style={{display:"flex",alignItems:"center",gap:5,padding:"9px 14px",background:"#16653a",color:"#fff",border:"none",borderRadius:7,fontSize:11,fontWeight:700,fontFamily:sans,boxShadow:"0 1px 3px rgba(0,0,0,0.15)"}}>
              <span>‚¨á</span> Export Excel
            </button>
          </div>
        </div>
      </div>

      <div style={{maxWidth:1100,margin:"0 auto",padding:"14px 24px"}}>
        {/* NAV */}
        <div style={{display:"flex",gap:2,marginBottom:14,background:"#fff",borderRadius:7,padding:3,width:"fit-content",border:"1px solid #e5e1dc",flexWrap:"wrap"}}>
          {[["overview","Overview"],["buckets","Engagement Buckets"],["timeline","Timeline"],["pricing","Monthly Pricing"],["success","Success Fees"],["market","Market Comparison"],["budget","Budget vs Actual"],["notes","Comments & Tasks"],["reqs","Requirements"],["marketing","Marketing \& Funnels"],["incentive","Sales Incentives"]].map(([k,l])=>(
            <button key={k} onClick={()=>setView(k)} style={{fontFamily:sans,padding:"5px 11px",borderRadius:5,border:"none",background:view===k?"#333":"transparent",color:view===k?"#fff":"#999",fontSize:10.5,fontWeight:700,cursor:"pointer",position:"relative"}}>
              {l}
              {k==="notes"&&comments.filter(c=>c.status==="Open").length>0&&<span style={{position:"absolute",top:1,right:1,width:6,height:6,borderRadius:"50%",background:"#dc2626"}}/>}
            </button>
          ))}
        </div>

        {/* ‚ïê‚ïê‚ïê OVERVIEW ‚ïê‚ïê‚ïê */}
        {view==="overview"&&<div>
          <div style={{background:"#fff",border:"1px solid #fecaca",borderLeft:"4px solid #dc2626",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:"#dc2626",marginBottom:4}}>The Situation</div>
            <div style={{fontSize:12,color:"#555",lineHeight:1.7}}>Abou Shakra generates <strong>EGP 120M</strong> in annual revenue but operates at <strong>negative EBITDA</strong>. Revenue is not the problem ‚Äî financial controls, cost visibility, and operational discipline are. This engagement moves EBITDA from negative to <strong>+10%</strong>, creating <strong>EGP 12M+</strong> in annual profit.</div>
          </div>
          <div style={{background:"#fef2f2",border:"1px solid #fecaca",borderLeft:"4px solid #dc2626",borderRadius:8,padding:"12px 16px",marginBottom:12,display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}}>
            <div>
              <div style={{fontFamily:mono,fontSize:8,color:"#dc2626",letterSpacing:1,marginBottom:3}}>üî• MONTH 1 TOTAL HOURS</div>
              <div style={{fontFamily:disp,fontSize:20,fontWeight:800,color:"#dc2626"}}>160h</div>
              <div style={{fontFamily:mono,fontSize:8.5,color:"#888"}}>Hard cap ‚Äî full availability</div>
            </div>
            <div>
              <div style={{fontFamily:mono,fontSize:8,color:"#dc2626",letterSpacing:1,marginBottom:3}}>‚ö° FIREFIGHTING (50%)</div>
              <div style={{fontFamily:disp,fontSize:20,fontWeight:800,color:"#dc2626"}}>80h</div>
              <div style={{fontFamily:mono,fontSize:8.5,color:"#888"}}>Suppliers ¬∑ Tax ¬∑ Customers ¬∑ Partners</div>
            </div>
            <div>
              <div style={{fontFamily:mono,fontSize:8,color:"#1e40af",letterSpacing:1,marginBottom:3}}>üìã DELIVERABLES (50%)</div>
              <div style={{fontFamily:disp,fontSize:20,fontWeight:800,color:"#1e40af"}}>80h</div>
              <div style={{fontFamily:mono,fontSize:8.5,color:"#888"}}>Revenue ‚Üí Cost ‚Üí Cash priority</div>
            </div>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6,marginBottom:14}}>
            {[{l:"Buckets",v:"5",s:"4 ops + 1 deal"},{l:"Tasks",v:String(tasks.length),s:"Deliverables"},{l:"M1 Cap",v:"160h",s:"80h firefighting + 80h work"},{l:"Retainer",v:"192K",s:"EGP/mo Month 1"},{l:"Target",v:"10%+",s:"EBITDA margin"}].map((s,i)=>(
              <div key={i} style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"10px 12px"}}>
                <div style={{fontFamily:mono,fontSize:8,color:"#aaa",letterSpacing:1,marginBottom:3}}>{s.l}</div>
                <div style={{fontFamily:disp,fontSize:20,fontWeight:800,lineHeight:1}}>{s.v}</div>
                <div style={{fontFamily:mono,fontSize:8.5,color:"#bbb",marginTop:2}}>{s.s}</div>
              </div>
            ))}
          </div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6,marginBottom:8}}>
            {buckets.slice(0,3).map(b=>{const bt=tasks.filter(t=>t.b===b.id);const ti=T[b.tier];
              return <div key={b.id} style={{background:"#fff",border:`1px solid ${b.bdr}`,borderLeft:`4px solid ${b.color}`,borderRadius:8,padding:"12px 14px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                  <span style={{fontSize:16}}>{b.ico}</span>
                  <span style={{fontFamily:mono,fontSize:8,color:ti.c,background:ti.tag,padding:"1px 5px",borderRadius:3}}>{ti.l}</span>
                </div>
                <div style={{fontFamily:disp,fontSize:12,fontWeight:700,color:"#222",marginBottom:2}}>{b.name}</div>
                <div style={{fontFamily:mono,fontSize:9,color:"#999"}}>{bt.length} tasks ¬∑ {bt.reduce((s,t)=>s+t.hrs,0)}h ¬∑ Wk {b.weeks}</div>
              </div>;
            })}
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:14}}>
            {buckets.slice(3).map(b=>{const bt=tasks.filter(t=>t.b===b.id);const ti=T[b.tier];
              return <div key={b.id} style={{background:"#fff",border:`1px solid ${b.bdr}`,borderLeft:`4px solid ${b.color}`,borderRadius:8,padding:"12px 14px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                  <span style={{fontSize:16}}>{b.ico}</span>
                  <span style={{fontFamily:mono,fontSize:8,color:ti.c,background:ti.tag,padding:"1px 5px",borderRadius:3}}>{ti.l}</span>
                </div>
                <div style={{fontFamily:disp,fontSize:12,fontWeight:700,color:"#222",marginBottom:2}}>{b.name}</div>
                <div style={{fontFamily:mono,fontSize:9,color:"#999"}}>{bt.length} tasks ¬∑ {bt.reduce((s,t)=>s+t.hrs,0)}h ¬∑ Wk {b.weeks}</div>
              </div>;
            })}
          </div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>
            {opsMonthly.map((m,i)=>(
              <div key={i} style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                  <span style={{fontFamily:disp,fontSize:13,fontWeight:700}}>{m.label}</span>
                  <span style={{fontFamily:mono,fontSize:8.5,color:"#aaa"}}>{m.wks}</span>
                </div>
                <div style={{fontFamily:disp,fontSize:20,fontWeight:800}}>EGP {m.retainer.toLocaleString()}</div>
                <div style={{fontFamily:mono,fontSize:9,color:"#bbb"}}>{m.hrs}h √ó EGP {RATE.toLocaleString()} = EGP {m.computed.toLocaleString()}{m.isFloor?" ‚Üí 100K min":""}</div>
              </div>
            ))}
          </div>
        </div>}

        {/* ‚ïê‚ïê‚ïê BUCKETS ‚ïê‚ïê‚ïê */}
        {view==="buckets"&&<div>
          <div style={{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap"}}>
            {Object.entries(PRIO).map(([k,p])=>(
              <div key={k} style={{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",background:p.bg,border:`1px solid ${p.bdr}`,borderRadius:6}}>
                <span style={{fontSize:11}}>{p.ico}</span>
                <span style={{fontFamily:mono,fontSize:8.5,color:p.c,fontWeight:700}}>{p.l}</span>
              </div>
            ))}
          </div>
          {buckets.map(b=>{
            const bt=tasks.filter(t=>t.b===b.id).slice().sort(prioSort);
            const ti=T[b.tier],isOpen=expBucket===b.id;
            const bh=bt.reduce((s,t)=>s+t.hrs,0);
            const groups=[{key:"rev",tasks:bt.filter(t=>t.prio==="rev")},{key:"cost",tasks:bt.filter(t=>t.prio==="cost")},{key:"cash",tasks:bt.filter(t=>t.prio==="cash")}].filter(g=>g.tasks.length>0);
            return <div key={b.id} style={{background:"#fff",border:isOpen?`1.5px solid ${b.color}50`:"1px solid #e5e1dc",borderRadius:10,padding:"14px 16px",marginBottom:6,borderLeft:`4px solid ${b.color}`}}>
              <div onClick={()=>{setExpBucket(isOpen?null:b.id);setExpTask(null)}} style={{cursor:"pointer"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
                  <div style={{flex:1}}>
                    <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:5}}>
                      <span style={{fontSize:18}}>{b.ico}</span>
                      <span style={{fontFamily:disp,fontSize:15,fontWeight:700,color:"#222"}}>{b.name}</span>
                      <span style={{fontFamily:mono,fontSize:8.5,color:ti.c,background:ti.tag,padding:"2px 6px",borderRadius:3,fontWeight:600}}>{ti.ico} {ti.l}</span>
                    </div>
                    <div style={{display:"flex",gap:4,marginBottom:6,flexWrap:"wrap"}}>
                      {b.impactPills.map((pill,pi)=>{const pr=PRIO[pill.p];return(
                        <div key={pi} style={{display:"flex",alignItems:"center",gap:3,padding:"3px 7px",background:pr.bg,border:`1px solid ${pr.bdr}`,borderRadius:4}}>
                          <span style={{fontSize:9}}>{pr.ico}</span>
                          <span style={{fontFamily:mono,fontSize:8,color:pr.c,fontWeight:700}}>{pill.v}</span>
                          <span style={{fontFamily:mono,fontSize:7.5,color:pr.c,opacity:0.75}}>{pill.l}</span>
                        </div>
                      );})}
                    </div>
                    <div style={{fontFamily:mono,fontSize:9.5,color:"#999",marginBottom:4}}>Week {b.weeks} ¬∑ {bt.length} tasks ¬∑ {bh} hours ¬∑ EGP {(bh*RATE).toLocaleString()}</div>
                    <div style={{fontSize:11.5,color:"#555",lineHeight:1.6}}>{b.desc}</div>
                  </div>
                  <span style={{fontSize:12,color:"#bbb",transform:isOpen?"rotate(180deg)":"",transition:"0.15s",marginLeft:10,flexShrink:0,marginTop:4}}>‚ñæ</span>
                </div>
              </div>
              {isOpen&&<div style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${b.bdr}`}}>
                {groups.map(g=>{const pr=PRIO[g.key];return(
                  <div key={g.key} style={{marginBottom:8}}>
                    <div style={{display:"flex",alignItems:"center",gap:5,padding:"4px 8px",background:pr.bg,borderRadius:5,marginBottom:4,borderLeft:`3px solid ${pr.c}`}}>
                      <span style={{fontSize:10}}>{pr.ico}</span>
                      <span style={{fontFamily:mono,fontSize:8,color:pr.c,fontWeight:700,letterSpacing:0.5}}>{pr.l.toUpperCase()}</span>
                      <span style={{fontFamily:mono,fontSize:7.5,color:pr.c,opacity:0.7}}>¬∑ {g.tasks.length} task{g.tasks.length>1?"s":""} ¬∑ {g.tasks.reduce((s,t)=>s+t.hrs,0)}h</span>
                    </div>
                    {g.tasks.map(t=><TaskCard key={t.id} t={t}/>)}
                  </div>
                );})}
                <div style={{display:"flex",justifyContent:"flex-end",padding:"6px 10px",background:"#fafaf8",borderRadius:5,marginTop:4}}>
                  <span style={{fontFamily:mono,fontSize:9,color:"#888"}}>{bt.length} tasks ¬∑ {bh}h ¬∑ </span>
                  <span style={{fontFamily:disp,fontSize:11,fontWeight:800,color:b.color,marginLeft:4}}>EGP {(bh*RATE).toLocaleString()}</span>
                </div>
              </div>}
            </div>;
          })}
        </div>}

        {/* ‚ïê‚ïê‚ïê TIMELINE ‚ïê‚ïê‚ïê */}
        {view==="timeline"&&<div style={{overflowX:"auto"}}>
          <div style={{display:"flex",gap:6,marginBottom:8,flexWrap:"wrap"}}>
            {Object.entries(PRIO).map(([k,p])=>(
              <div key={k} style={{display:"flex",alignItems:"center",gap:4,padding:"3px 8px",background:p.bg,border:`1px solid ${p.bdr}`,borderRadius:4}}>
                <div style={{width:12,height:6,borderRadius:2,background:p.c}}/>
                <span style={{fontFamily:mono,fontSize:8,color:p.c,fontWeight:700}}>{p.ico} {p.l}</span>
              </div>
            ))}
            <div style={{display:"flex",alignItems:"center",gap:4,padding:"3px 8px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:4}}>
              <div style={{width:12,height:6,borderRadius:2,background:"#dc2626"}}/>
              <span style={{fontFamily:mono,fontSize:8,color:"#dc2626",fontWeight:700}}>üî• Firefighting (M1 reserved)</span>
            </div>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"190px repeat(12,1fr)",gap:0,marginBottom:4}}>
            <div style={{padding:"5px 6px"}}><span style={{fontFamily:mono,fontSize:8,color:"#aaa"}}>BUCKET / TASK</span></div>
            {WEEKS.map(w=>{const ms=[{w:4,c:"#dc2626",l:"M1"},{w:8,c:"#a16207",l:"M2"},{w:12,c:"#1e40af",l:"M3"}].find(m=>m.w===w);
              return <div key={w} style={{textAlign:"center",padding:"3px 1px"}}>
                <div style={{fontFamily:mono,fontSize:8,color:ms?ms.c:"#bbb",fontWeight:ms?700:400}}>W{w}</div>
                {ms&&<div style={{fontFamily:mono,fontSize:6,color:ms.c}}>{ms.l}</div>}
              </div>;
            })}
          </div>
          <div style={{display:"grid",gridTemplateColumns:"190px repeat(12,1fr)",gap:0,marginBottom:4}}>
            <div style={{padding:"3px 6px",display:"flex",alignItems:"center",gap:3}}>
              <span style={{fontFamily:mono,fontSize:7.5,color:"#dc2626",fontWeight:700}}>üî• FIREFIGHTING</span>
            </div>
            {WEEKS.map(w=>(
              <div key={w} style={{padding:"2px 1px",display:"flex",alignItems:"center"}}>
                {w<=4&&<div style={{width:"100%",height:10,background:"#fca5a540",borderLeft:w===1?"2px solid #dc2626":"none",borderRadius:w===1&&4?"3px":w===1?"3px 0 0 3px":w===4?"0 3px 3px 0":0,display:"flex",alignItems:"center",justifyContent:"center"}}>
                  {w===1&&<span style={{fontFamily:mono,fontSize:6,color:"#dc2626",fontWeight:700}}>80h</span>}
                </div>}
              </div>
            ))}
          </div>
          {buckets.map(b=>{
            const bt=tasks.filter(t=>t.b===b.id).slice().sort(prioSort);
            return <div key={b.id} style={{marginBottom:3}}>
              <div style={{display:"grid",gridTemplateColumns:"190px repeat(12,1fr)",gap:0,marginBottom:1}}>
                <div style={{padding:"4px 6px",background:b.bg,borderRadius:"4px 0 0 4px",borderLeft:`3px solid ${b.color}`,display:"flex",alignItems:"center",gap:3}}>
                  <span style={{fontSize:10}}>{b.ico}</span>
                  <span style={{fontFamily:mono,fontSize:7.5,color:b.color,fontWeight:700}}>{b.name.toUpperCase()}</span>
                </div>
                {WEEKS.map(w=><div key={w} style={{background:b.bg,borderRadius:w===12?"0 4px 4px 0":0}}/>)}
              </div>
              {bt.map(t=>{
                const pr=PRIO[t.prio],imp=IMP[t.impact],isKey=t.impact==="high"&&t.tier==="quick";
                return <div key={t.id} style={{display:"grid",gridTemplateColumns:"190px repeat(12,1fr)",gap:0,marginBottom:1}}>
                  <div style={{padding:"3px 6px",display:"flex",alignItems:"center",gap:3}}>
                    <div style={{width:4,height:4,borderRadius:"50%",background:pr.c,flexShrink:0}}/>
                    <span style={{fontFamily:mono,fontSize:7,color:"#bbb",width:14,textAlign:"right",flexShrink:0}}>{t.id}</span>
                    <div style={{display:"flex",gap:1,flexShrink:0}}>{[1,2,3].map(i=><div key={i} style={{width:2,height:7,borderRadius:1,background:i<=imp.n?imp.c:"#ddd"}}/>)}</div>
                    <span style={{fontSize:isKey?9.5:8.5,color:"#555",fontWeight:isKey?700:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{t.name}</span>
                  </div>
                  {WEEKS.map(w=>{const act=w>=t.w[0]&&w<=t.w[1],isS=w===t.w[0],isE=w===t.w[1];
                    return <div key={w} style={{padding:"2px 1px",display:"flex",alignItems:"center"}}>
                      {act&&<div style={{width:"100%",height:isKey?15:11,background:`${pr.c}20`,borderLeft:isS?`2px solid ${pr.c}`:"none",borderRadius:isS&&isE?"3px":isS?"3px 0 0 3px":isE?"0 3px 3px 0":0,display:"flex",alignItems:"center",justifyContent:"center"}}>
                        {isS&&<span style={{fontFamily:mono,fontSize:6,color:pr.c,fontWeight:700}}>{t.hrs}h</span>}
                      </div>}
                    </div>;
                  })}
                </div>;
              })}
            </div>;
          })}
        </div>}

        {/* ‚ïê‚ïê‚ïê MONTHLY PRICING ‚ïê‚ïê‚ïê */}
        {view==="pricing"&&<div>
          <div style={{background:"#fefce8",border:"1px solid #fde68a",borderRadius:8,padding:"12px 16px",marginBottom:10}}>
            <div style={{fontSize:12,color:"#92400e",lineHeight:1.6}}><strong>Pricing logic:</strong> Each month priced on actual hours √ó EGP {RATE.toLocaleString()}/hr. Minimum retainer EGP {MIN_RETAINER.toLocaleString()}. Tasks ordered by financial priority: Revenue ‚Üí Cost ‚Üí Cash.</div>
          </div>
          <div style={{background:"#fef2f2",border:"1px solid #fecaca",borderLeft:"4px solid #dc2626",borderRadius:8,padding:"12px 16px",marginBottom:14}}>
            <div style={{fontFamily:mono,fontSize:9,color:"#dc2626",fontWeight:700,letterSpacing:1,marginBottom:4}}>MONTH 1 ‚Äî HOUR ALLOCATION (160h CAP)</div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
              <div style={{background:"#fff",borderRadius:6,padding:"10px 12px",border:"1px solid #fecaca"}}>
                <div style={{fontFamily:mono,fontSize:8,color:"#dc2626",marginBottom:2}}>üî• FIREFIGHTING & NEGOTIATIONS</div>
                <div style={{fontFamily:disp,fontSize:22,fontWeight:800,color:"#dc2626"}}>80h</div>
                <div style={{fontSize:10,color:"#888"}}>Suppliers ¬∑ Customers ¬∑ Tax ¬∑ Partners</div>
              </div>
              <div style={{background:"#fff",borderRadius:6,padding:"10px 12px",border:"1px solid #fecaca"}}>
                <div style={{fontFamily:mono,fontSize:8,color:"#1e40af",marginBottom:2}}>üìã STRUCTURED DELIVERABLES</div>
                <div style={{fontFamily:disp,fontSize:22,fontWeight:800,color:"#1e40af"}}>80h</div>
                <div style={{fontSize:10,color:"#888"}}>Revenue ‚Üí Cost ‚Üí Cash priority</div>
              </div>
            </div>
          </div>

          <div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:"#222",marginBottom:8}}>Operations Engagement</div>
          {opsMonthly.map((m,mi)=>{
            const sorted=m.tasks.slice().sort(prioSort);
            const groups=[{key:"rev",tasks:sorted.filter(t=>t.prio==="rev")},{key:"cost",tasks:sorted.filter(t=>t.prio==="cost")},{key:"cash",tasks:sorted.filter(t=>t.prio==="cash")}].filter(g=>g.tasks.length>0);
            return <div key={mi} style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:10,padding:"14px 16px",marginBottom:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
                <div>
                  <div style={{fontFamily:disp,fontSize:15,fontWeight:700}}>{m.label}</div>
                  <div style={{fontFamily:mono,fontSize:9.5,color:"#aaa"}}>{m.wks} ¬∑ {m.tasks.length} active tasks{mi===0?" ¬∑ 80h firefighting reserved":""}</div>
                </div>
                <div style={{textAlign:"right"}}>
                  <div style={{fontFamily:disp,fontSize:24,fontWeight:800}}>EGP {m.retainer.toLocaleString()}</div>
                  <div style={{fontFamily:mono,fontSize:9,color:m.isFloor?"#D4863A":"#bbb"}}>{m.hrs}h √ó EGP {RATE.toLocaleString()} = EGP {m.computed.toLocaleString()}{m.isFloor?" ‚Üí min retainer":""}</div>
                </div>
              </div>
              {mi===0&&<div style={{display:"grid",gridTemplateColumns:"20px 1fr 60px 42px 70px",gap:4,alignItems:"center",padding:"5px 6px",background:"#fef2f2",borderRadius:4,marginBottom:6,border:"1px solid #fecaca"}}>
                <span style={{fontFamily:mono,fontSize:10,color:"#dc2626",textAlign:"right"}}>üî•</span>
                <span style={{fontSize:10,color:"#dc2626",fontWeight:700}}>Firefighting & Counter-Party Negotiations</span>
                <span style={{fontFamily:mono,fontSize:7.5,color:"#dc2626",background:"#fee2e2",padding:"1px 3px",borderRadius:2,textAlign:"center"}}>Reserved</span>
                <span style={{fontFamily:mono,fontSize:8.5,color:"#dc2626",textAlign:"center",fontWeight:700}}>{M1_FIREFIGHT}h</span>
                <span style={{fontFamily:mono,fontSize:8.5,color:"#dc2626",textAlign:"right",fontWeight:700}}>EGP {(M1_FIREFIGHT*RATE).toLocaleString()}</span>
              </div>}
              {groups.map(g=>{
                const pr=PRIO[g.key];
                const grpHrs=g.tasks.reduce((s,t)=>{const span=t.w[1]-t.w[0]+1;let ov=0;for(let w=m.w[0];w<=m.w[1];w++) if(w>=t.w[0]&&w<=t.w[1]) ov++;return s+Math.round(t.hrs*ov/span);},0);
                return <div key={g.key} style={{marginBottom:6}}>
                  <div style={{display:"grid",gridTemplateColumns:"20px 1fr 60px 42px 70px",gap:4,alignItems:"center",padding:"4px 6px",background:pr.bg,borderRadius:4,marginBottom:2,border:`1px solid ${pr.bdr}`}}>
                    <span style={{fontSize:10,textAlign:"center"}}>{pr.ico}</span>
                    <span style={{fontFamily:mono,fontSize:8,color:pr.c,fontWeight:700}}>{pr.l.toUpperCase()}</span>
                    <span style={{fontFamily:mono,fontSize:7.5,color:pr.c,background:pr.tag,padding:"1px 3px",borderRadius:2,textAlign:"center"}}>{g.tasks.length} tasks</span>
                    <span style={{fontFamily:mono,fontSize:8,color:pr.c,textAlign:"center",fontWeight:600}}>{grpHrs}h</span>
                    <span style={{fontFamily:mono,fontSize:8,color:pr.c,textAlign:"right",fontWeight:700}}>EGP {(grpHrs*RATE).toLocaleString()}</span>
                  </div>
                  {g.tasks.map(t=>{const ti=T[t.tier],span=t.w[1]-t.w[0]+1;let ov=0;
                    for(let w=m.w[0];w<=m.w[1];w++) if(w>=t.w[0]&&w<=t.w[1]) ov++;
                    const mh=Math.round(t.hrs*ov/span);
                    return <div key={t.id} style={{display:"grid",gridTemplateColumns:"20px 1fr 60px 42px 70px",gap:4,alignItems:"center",padding:"3px 6px",background:"#fafaf8",borderRadius:3,marginBottom:1,border:"1px solid #f0f0ee",borderLeft:`2px solid ${pr.c}30`}}>
                      <span style={{fontFamily:mono,fontSize:8,color:"#ccc",textAlign:"right"}}>{t.id}</span>
                      <span style={{fontSize:10,color:"#555",fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{t.name}</span>
                      <span style={{fontFamily:mono,fontSize:7.5,color:ti.c,background:ti.tag,padding:"1px 3px",borderRadius:2,textAlign:"center"}}>{ti.l}</span>
                      <span style={{fontFamily:mono,fontSize:8.5,color:"#888",textAlign:"center"}}>{mh}h</span>
                      <span style={{fontFamily:mono,fontSize:8.5,color:"#333",textAlign:"right",fontWeight:600}}>EGP {(mh*RATE).toLocaleString()}</span>
                    </div>;
                  })}
                </div>;
              })}
            </div>;
          })}
          <div style={{background:"#333",borderRadius:8,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
            <div><span style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#fff"}}>Operations Total (3 months)</span>
              <div style={{fontFamily:mono,fontSize:9,color:"#999"}}>{opsTasks.reduce((s,t)=>s+t.hrs,0)} total hours</div></div>
            <div style={{textAlign:"right"}}>
              <span style={{fontFamily:disp,fontSize:22,fontWeight:800,color:"#D4863A"}}>EGP {opsTotal.toLocaleString()}</span>
              <div style={{fontFamily:mono,fontSize:8.5,color:"#999"}}>~${Math.round(opsTotal/FX).toLocaleString()} USD</div>
            </div>
          </div>

          <div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:"#222",marginBottom:8}}>ü§ù Deal Negotiations (Separate Track)</div>
          {dealMonthly.filter(m=>m.hrs>0).map((m,mi)=>{
            const sorted=m.tasks.slice().sort(prioSort);
            const groups=[{key:"rev",tasks:sorted.filter(t=>t.prio==="rev")},{key:"cost",tasks:sorted.filter(t=>t.prio==="cost")},{key:"cash",tasks:sorted.filter(t=>t.prio==="cash")}].filter(g=>g.tasks.length>0);
            return <div key={mi} style={{background:"#fff",border:`1px solid ${D.deals.bdr}`,borderRadius:10,padding:"14px 16px",marginBottom:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                <div><div style={{fontFamily:disp,fontSize:15,fontWeight:700}}>{m.label}</div><div style={{fontFamily:mono,fontSize:9.5,color:"#aaa"}}>{m.wks}</div></div>
                <div style={{textAlign:"right"}}>
                  <div style={{fontFamily:disp,fontSize:24,fontWeight:800}}>EGP {m.retainer.toLocaleString()}</div>
                  <div style={{fontFamily:mono,fontSize:9,color:m.isFloor?"#D4863A":"#bbb"}}>{m.hrs}h √ó EGP {RATE.toLocaleString()} = EGP {m.computed.toLocaleString()}{m.isFloor?" ‚Üí min retainer":""}</div>
                </div>
              </div>
              {groups.map(g=>{const pr=PRIO[g.key];const grpHrs=g.tasks.reduce((s,t)=>s+t.hrs,0);return(
                <div key={g.key} style={{marginBottom:5}}>
                  <div style={{display:"grid",gridTemplateColumns:"20px 1fr 42px 70px",gap:4,alignItems:"center",padding:"3px 6px",background:pr.bg,borderRadius:4,marginBottom:2,border:`1px solid ${pr.bdr}`}}>
                    <span style={{fontSize:10,textAlign:"center"}}>{pr.ico}</span>
                    <span style={{fontFamily:mono,fontSize:8,color:pr.c,fontWeight:700}}>{pr.l.toUpperCase()}</span>
                    <span style={{fontFamily:mono,fontSize:8,color:pr.c,textAlign:"center"}}>{grpHrs}h</span>
                    <span style={{fontFamily:mono,fontSize:8,color:pr.c,textAlign:"right",fontWeight:700}}>EGP {(grpHrs*RATE).toLocaleString()}</span>
                  </div>
                  {g.tasks.map(t=>(
                    <div key={t.id} style={{display:"grid",gridTemplateColumns:"20px 1fr 42px 70px",gap:4,alignItems:"center",padding:"3px 6px",background:"#fafaf8",borderRadius:3,marginBottom:1,borderLeft:`2px solid ${pr.c}30`}}>
                      <span style={{fontFamily:mono,fontSize:8,color:"#ccc",textAlign:"right"}}>{t.id}</span>
                      <span style={{fontSize:10,color:"#555"}}>{t.name}</span>
                      <span style={{fontFamily:mono,fontSize:8.5,color:"#888",textAlign:"center"}}>{t.hrs}h</span>
                      <span style={{fontFamily:mono,fontSize:8.5,color:"#333",textAlign:"right",fontWeight:600}}>EGP {(t.hrs*RATE).toLocaleString()}</span>
                    </div>
                  ))}
                </div>
              );})}
            </div>;
          })}
          <div style={{background:D.deals.c,borderRadius:8,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
            <span style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#fff"}}>Deal Negotiations Total (2 months)</span>
            <span style={{fontFamily:disp,fontSize:22,fontWeight:800,color:"#fff"}}>EGP {dealTotal.toLocaleString()}</span>
          </div>
          <div style={{background:"#1a1a1a",borderRadius:10,padding:"18px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
            <div>
              <div style={{fontFamily:disp,fontSize:16,fontWeight:700,color:"#fff"}}>Total Base Engagement</div>
              <div style={{fontFamily:mono,fontSize:9.5,color:"#666"}}>Ops (3 mo) + Deals (2 mo) + Success Fees on milestones</div>
            </div>
            <div style={{textAlign:"right"}}>
              <div style={{fontFamily:disp,fontSize:30,fontWeight:800,color:"#D4863A"}}>EGP {grandTotal.toLocaleString()}</div>
              <div style={{fontFamily:mono,fontSize:9,color:"#666"}}>~${Math.round(grandTotal/FX).toLocaleString()} USD</div>
            </div>
          </div>
        </div>}

        {/* ‚ïê‚ïê‚ïê SUCCESS FEES ‚ïê‚ïê‚ïê */}
        {view==="success"&&<div>
          <div style={{background:"#fff",border:"1px solid #fecaca",borderLeft:"4px solid #dc2626",borderRadius:8,padding:"14px 16px",marginBottom:14}}>
            <div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:"#dc2626",marginBottom:4}}>Context: EGP 120M Revenue ¬∑ Negative EBITDA</div>
            <div style={{fontSize:11.5,color:"#555",lineHeight:1.6}}>Each milestone is a verified, measurable step from negative profitability to healthy EBITDA. C¬≤ only earns success fees when Abou Shakra achieves real, audited profit improvement.</div>
          </div>
          {milestoneFees.map(m=>{const isOpen=expFee===m.id;
            return <div key={m.id} onClick={()=>setExpFee(isOpen?null:m.id)} style={{background:"#fff",border:isOpen?`1.5px solid ${m.color}40`:"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px",marginBottom:4,cursor:"pointer"}}>
              <div style={{display:"grid",gridTemplateColumns:"28px 1fr 120px",gap:8,alignItems:"center"}}>
                <span style={{fontSize:18,textAlign:"center"}}>{m.icon}</span>
                <div><div style={{fontSize:12.5,fontWeight:700,color:"#222"}}>{m.milestone}</div>
                  <div style={{fontFamily:mono,fontSize:9.5,color:"#999",marginTop:1}}>Saving: {m.saving}</div></div>
                <div style={{textAlign:"center"}}>
                  <div style={{fontFamily:disp,fontSize:18,fontWeight:800,color:m.color}}>{m.feeLabel}</div>
                  <div style={{fontFamily:mono,fontSize:7.5,color:"#bbb"}}>success fee</div>
                </div>
              </div>
              {isOpen&&<div style={{marginTop:8,paddingTop:8,borderTop:"1px solid #eee",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}} onClick={e=>e.stopPropagation()}>
                <div style={{background:"#fafaf8",borderRadius:6,padding:"8px 10px",border:"1px solid #eee"}}>
                  <div style={{fontFamily:mono,fontSize:8,color:"#999",marginBottom:2}}>CURRENT</div>
                  <div style={{fontSize:11,color:"#555"}}>{m.current}</div>
                </div>
                <div style={{background:"#f0fdf4",borderRadius:6,padding:"8px 10px",border:"1px solid #bbf7d0"}}>
                  <div style={{fontFamily:mono,fontSize:8,color:"#16653a",marginBottom:2}}>TARGET</div>
                  <div style={{fontSize:11,color:"#16653a",fontWeight:600}}>{m.target}</div>
                </div>
                <div style={{background:"#eff6ff",borderRadius:6,padding:"8px 10px",border:"1px solid #dbeafe"}}>
                  <div style={{fontFamily:mono,fontSize:8,color:"#1e40af",marginBottom:2}}>VERIFICATION</div>
                  <div style={{fontSize:10.5,color:"#1e40af",lineHeight:1.5}}>{m.how}</div>
                </div>
              </div>}
            </div>;
          })}
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6,marginTop:10}}>
            <div style={{background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:8,padding:"12px 14px",textAlign:"center"}}>
              <div style={{fontFamily:mono,fontSize:8,color:"#16653a"}}>ABOU SHAKRA GAINS</div>
              <div style={{fontFamily:disp,fontSize:24,fontWeight:800,color:"#16653a"}}>EGP 12M+</div>
              <div style={{fontFamily:mono,fontSize:9,color:"#888"}}>annual profit at 10% EBITDA</div>
            </div>
            <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px",textAlign:"center"}}>
              <div style={{fontFamily:mono,fontSize:8,color:"#999"}}>C¬≤ EARNS (MAX)</div>
              <div style={{fontFamily:disp,fontSize:24,fontWeight:800,color:"#D4863A"}}>EGP 1.75M</div>
              <div style={{fontFamily:mono,fontSize:9,color:"#888"}}>all milestones achieved</div>
            </div>
            <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px",textAlign:"center"}}>
              <div style={{fontFamily:mono,fontSize:8,color:"#999"}}>CLIENT ROI</div>
              <div style={{fontFamily:disp,fontSize:24,fontWeight:800,color:"#7c3aed"}}>{Math.round(12000000/(grandTotal+1750000))}:1</div>
              <div style={{fontFamily:mono,fontSize:9,color:"#888"}}>return on total cost</div>
            </div>
          </div>
        </div>}

        {/* ‚ïê‚ïê‚ïê MARKET ‚ïê‚ïê‚ïê */}
        {view==="market"&&<div>
          {marketComp.map((m,i)=>{const isUs=m.provider.startsWith("C¬≤");
            return <div key={i} style={{background:isUs?"#f0fdf4":"#fff",border:isUs?"1.5px solid #bbf7d0":"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px",marginBottom:5}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}}>
                <div><div style={{fontSize:13,fontWeight:700,color:isUs?"#16653a":"#222"}}>{isUs?"‚úÖ ":""}{m.provider}</div></div>
                <div style={{textAlign:"right"}}><div style={{fontFamily:disp,fontSize:14,fontWeight:800,color:isUs?"#16653a":"#333"}}>{m.monthly}/mo</div>
                  <div style={{fontFamily:mono,fontSize:8.5,color:"#bbb"}}>Total: {m.total}</div></div>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 70px",gap:6}}>
                <div style={{background:"#fafaf8",borderRadius:5,padding:"6px 8px",border:"1px solid #eee"}}>
                  <div style={{fontFamily:mono,fontSize:7.5,color:"#999"}}>SUCCESS FEE</div>
                  <div style={{fontSize:10.5,color:"#555",marginTop:2}}>{m.success}</div>
                </div>
                <div style={{background:isUs?"#dcfce7":"#fafaf8",borderRadius:5,padding:"6px 8px",border:isUs?"1px solid #bbf7d0":"1px solid #eee"}}>
                  <div style={{fontFamily:mono,fontSize:7.5,color:isUs?"#16653a":"#999"}}>VERDICT</div>
                  <div style={{fontSize:10.5,color:isUs?"#16653a":"#555",fontWeight:isUs?600:400,marginTop:2}}>{m.verdict}</div>
                </div>
                <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:isUs?"#dcfce7":"#fafaf8",borderRadius:5,border:isUs?"1px solid #bbf7d0":"1px solid #eee",padding:8}}>
                  <div style={{fontFamily:mono,fontSize:7.5,color:"#999"}}>FIT</div>
                  <div style={{display:"flex",gap:2,marginTop:2}}>{[1,2,3,4,5].map(j=><div key={j} style={{width:5,height:5,borderRadius:"50%",background:j<=m.score?isUs?"#16653a":"#D4863A":"#ddd"}}/>)}</div>
                </div>
              </div>
            </div>;
          })}
        </div>}

        {/* ‚ïê‚ïê‚ïê BUDGET VS ACTUAL ‚ïê‚ïê‚ïê */}
        {view==="budget"&&<div>
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:14,fontWeight:700,marginBottom:6}}>üìä Forecast P&L vs. Actual ‚Äî Per Branch</div>
            <div style={{fontSize:11.5,color:"#666",lineHeight:1.6,marginBottom:12}}>Enter forecast and actual figures for each branch and month. All values in EGP. EBITDA = Revenue ‚àí Food Cost ‚àí Labour Cost. Variances update automatically.</div>

            {/* Add row controls */}
            <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginBottom:8}}>
              <select value={budgetBranch} onChange={e=>setBudgetBranch(e.target.value)} style={{padding:"6px 10px",border:"1px solid #ddd",borderRadius:6,fontSize:11,fontFamily:sans,background:"#fafaf8"}}>
                {BRANCHES.map(b=><option key={b} value={b}>{b}</option>)}
              </select>
              <select value={budgetMonth} onChange={e=>setBudgetMonth(e.target.value)} style={{padding:"6px 10px",border:"1px solid #ddd",borderRadius:6,fontSize:11,fontFamily:sans,background:"#fafaf8"}}>
                {MONTHS_LIST.map(m=><option key={m} value={m}>{m}</option>)}
              </select>
              <button onClick={addBudgetRow} style={{padding:"6px 14px",background:"#1e40af",color:"#fff",border:"none",borderRadius:6,fontSize:11,fontWeight:700,fontFamily:sans}}>+ Add Row</button>
            </div>

            {/* Data entry table */}
            {budgetData.length===0?<div style={{textAlign:"center",padding:"30px",color:"#aaa",fontFamily:mono,fontSize:11}}>No data yet. Select a branch and month above, then click + Add Row.</div>:(
              <div style={{overflowX:"auto"}}>
                <table style={{width:"100%",borderCollapse:"collapse",fontSize:11}}>
                  <thead>
                    <tr style={{background:"#f5f3f0"}}>
                      {["Branch","Month","Rev Forecast","Rev Actual","Rev Var","FC Forecast","FC Actual","FC Var","Lab Forecast","Lab Actual","Lab Var","EBITDA F","EBITDA A","EBITDA Var",""].map((h,i)=>(
                        <th key={i} style={{padding:"6px 8px",fontFamily:mono,fontSize:8,color:"#666",letterSpacing:0.5,textAlign:i>=2?"right":"left",borderBottom:"2px solid #e5e1dc",whiteSpace:"nowrap"}}>{h}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {budgetData.map(row=>{
                      const revVar=(Number(row.revA)||0)-(Number(row.revF)||0);
                      const fcVar=(Number(row.fcA)||0)-(Number(row.fcF)||0);
                      const labVar=(Number(row.labA)||0)-(Number(row.labF)||0);
                      const ebitdaF=(Number(row.revF)||0)-(Number(row.fcF)||0)-(Number(row.labF)||0);
                      const ebitdaA=(Number(row.revA)||0)-(Number(row.fcA)||0)-(Number(row.labA)||0);
                      const ebitdaVar=ebitdaA-ebitdaF;
                      const varCell=(v,invert=false)=>{
                        const good=invert?v<0:v>0;
                        const c=v===0?"#888":good?"#16653a":"#dc2626";
                        return <td style={{padding:"5px 8px",fontFamily:mono,fontSize:10,textAlign:"right",color:c,fontWeight:600}}>{v===0?"-":(v>0?"+":"")+v.toLocaleString()}</td>;
                      };
                      const editInput=(field)=><input type="number" value={row[field]} onChange={e=>updateBudget(row.id,field,e.target.value)} style={{width:80,padding:"3px 5px",border:"1px solid #ddd",borderRadius:3,fontSize:10,fontFamily:mono,textAlign:"right",background:"#fafaf8"}}/>;
                      return <tr key={row.id} style={{borderBottom:"1px solid #f0f0ee"}}>
                        <td style={{padding:"5px 8px",fontWeight:600,fontSize:11}}>{row.branch}</td>
                        <td style={{padding:"5px 8px",fontFamily:mono,fontSize:10,color:"#666"}}>{row.month}</td>
                        <td style={{padding:"5px 8px",textAlign:"right"}}>{editInput("revF")}</td>
                        <td style={{padding:"5px 8px",textAlign:"right"}}>{editInput("revA")}</td>
                        {varCell(revVar)}
                        <td style={{padding:"5px 8px",textAlign:"right"}}>{editInput("fcF")}</td>
                        <td style={{padding:"5px 8px",textAlign:"right"}}>{editInput("fcA")}</td>
                        {varCell(fcVar,true)}
                        <td style={{padding:"5px 8px",textAlign:"right"}}>{editInput("labF")}</td>
                        <td style={{padding:"5px 8px",textAlign:"right"}}>{editInput("labA")}</td>
                        {varCell(labVar,true)}
                        <td style={{padding:"5px 8px",fontFamily:mono,fontSize:10,textAlign:"right",color:"#1e40af"}}>{ebitdaF.toLocaleString()}</td>
                        <td style={{padding:"5px 8px",fontFamily:mono,fontSize:10,textAlign:"right",color:"#1e40af",fontWeight:600}}>{ebitdaA.toLocaleString()}</td>
                        {varCell(ebitdaVar)}
                        <td style={{padding:"5px 8px"}}><button onClick={()=>deleteBudgetRow(row.id)} style={{background:"#fee2e2",border:"none",borderRadius:3,padding:"2px 6px",fontSize:9,color:"#dc2626",cursor:"pointer",fontFamily:mono}}>‚úï</button></td>
                      </tr>;
                    })}
                  </tbody>
                </table>
              </div>
            )}
          </div>

          {/* Branch summary cards */}
          {budgetData.length>0&&<div>
            <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginBottom:8}}>BRANCH SUMMARY (ALL MONTHS COMBINED)</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8}}>
              {BRANCHES.filter(b=>budgetSummary[b]?.count>0).map(b=>{
                const s=budgetSummary[b];
                const ebitdaF=s.revF-s.fcF-s.labF, ebitdaA=s.revA-s.fcA-s.labA;
                const ebitdaVar=ebitdaA-ebitdaF;
                const pct=s.revA>0?((ebitdaA/s.revA)*100).toFixed(1):"‚Äî";
                const col=ebitdaA>0?"#16653a":ebitdaA<0?"#dc2626":"#888";
                return <div key={b} style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px",borderLeft:`4px solid ${col}`}}>
                  <div style={{fontFamily:disp,fontSize:13,fontWeight:700,marginBottom:4}}>{b}</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4}}>
                    <div>
                      <div style={{fontFamily:mono,fontSize:7.5,color:"#aaa"}}>REV ACTUAL</div>
                      <div style={{fontFamily:mono,fontSize:10,fontWeight:600}}>{s.revA.toLocaleString()}</div>
                    </div>
                    <div>
                      <div style={{fontFamily:mono,fontSize:7.5,color:"#aaa"}}>EBITDA</div>
                      <div style={{fontFamily:mono,fontSize:10,fontWeight:600,color:col}}>{ebitdaA.toLocaleString()} ({pct}%)</div>
                    </div>
                    <div>
                      <div style={{fontFamily:mono,fontSize:7.5,color:"#aaa"}}>FOOD COST</div>
                      <div style={{fontFamily:mono,fontSize:10,color:s.fcA>s.fcF?"#dc2626":"#16653a"}}>{s.fcA.toLocaleString()}</div>
                    </div>
                    <div>
                      <div style={{fontFamily:mono,fontSize:7.5,color:"#aaa"}}>EBITDA VAR</div>
                      <div style={{fontFamily:mono,fontSize:10,fontWeight:600,color:ebitdaVar>0?"#16653a":ebitdaVar<0?"#dc2626":"#888"}}>{ebitdaVar>0?"+":""}{ebitdaVar.toLocaleString()}</div>
                    </div>
                  </div>
                  <div style={{fontFamily:mono,fontSize:7.5,color:"#bbb",marginTop:6}}>{s.count} month{s.count>1?"s":""} of data</div>
                </div>;
              })}
            </div>

            {/* Total bar */}
            <div style={{marginTop:12,background:"#1a1a1a",borderRadius:8,padding:"14px 16px",display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10}}>
              {budgetTotals.map((s,i)=><div key={i}><div style={{fontFamily:mono,fontSize:7.5,color:"#666",letterSpacing:1}}>{s.l}</div><div style={{fontFamily:disp,fontSize:18,fontWeight:800,color:s.c}}>{s.v}</div></div>)}
            </div>
          </div>}
        </div>}

        {/* ‚ïê‚ïê‚ïê COMMENTS & TASKS ‚ïê‚ïê‚ïê */}
        {view==="notes"&&<div>
          <div style={{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap",alignItems:"center"}}>
            <div>
              <div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:"#222"}}>Comments & Action Items</div>
              <div style={{fontFamily:mono,fontSize:9,color:"#aaa"}}>{comments.length} entries ¬∑ {comments.filter(c=>c.status==="Open").length} open</div>
            </div>
            <div style={{flex:1}}/>
            <select value={commentFilter} onChange={e=>setCommentFilter(e.target.value)} style={{padding:"5px 9px",border:"1px solid #ddd",borderRadius:5,fontSize:10,fontFamily:sans}}>
              <option value="all">All types</option>
              <option value="comment">Comments only</option>
              <option value="action">Action items only</option>
              <option value="risk">Risks only</option>
              <option value="decision">Decisions only</option>
            </select>
            <button onClick={()=>setShowAddComment(true)} style={{padding:"7px 13px",background:"#1e40af",color:"#fff",border:"none",borderRadius:6,fontSize:11,fontWeight:700,fontFamily:sans}}>+ Add Comment</button>
            <button onClick={()=>setShowAddTask(true)} style={{padding:"7px 13px",background:"#16653a",color:"#fff",border:"none",borderRadius:6,fontSize:11,fontWeight:700,fontFamily:sans}}>+ Add Task</button>
          </div>

          {comments.length===0?<div style={{textAlign:"center",padding:"40px",color:"#aaa",fontFamily:mono,fontSize:11,background:"#fff",borderRadius:8,border:"1px dashed #ddd"}}>No comments yet. Add your first comment or action item above.</div>
          :(comments.filter(c=>commentFilter==="all"||c.type===commentFilter).map(c=>{
            const typeConfig={comment:{ico:"üí¨",c:"#1e40af",bg:"#eff6ff",bdr:"#bfdbfe"},action:{ico:"‚úÖ",c:"#16653a",bg:"#f0fdf4",bdr:"#bbf7d0"},risk:{ico:"‚ö†Ô∏è",c:"#dc2626",bg:"#fef2f2",bdr:"#fecaca"},decision:{ico:"üéØ",c:"#7c3aed",bg:"#faf5ff",bdr:"#ddd6fe"}}[c.type]||{ico:"üí¨",c:"#666",bg:"#fafaf8",bdr:"#e5e1dc"};
            const isOpen=c.status==="Open";
            return <div key={c.id} style={{background:typeConfig.bg,border:`1px solid ${typeConfig.bdr}`,borderRadius:8,padding:"10px 14px",marginBottom:6,borderLeft:`3px solid ${typeConfig.c}`,opacity:isOpen?1:0.7}}>
              <div style={{display:"flex",gap:8,alignItems:"flex-start"}}>
                <span style={{fontSize:14,flexShrink:0}}>{typeConfig.ico}</span>
                <div style={{flex:1,minWidth:0}}>
                  <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:3,flexWrap:"wrap"}}>
                    <span style={{fontFamily:mono,fontSize:9,color:typeConfig.c,background:"#fff",padding:"1px 5px",borderRadius:3,fontWeight:700,textTransform:"uppercase"}}>{c.type}</span>
                    {c.task&&<span style={{fontFamily:mono,fontSize:8.5,color:"#888"}}>re: {c.task}</span>}
                    <span style={{fontFamily:mono,fontSize:8,color:"#bbb",marginLeft:"auto"}}>{c.author} ¬∑ {c.date}</span>
                  </div>
                  <div style={{fontSize:11.5,color:"#333",lineHeight:1.6}}>{c.content}</div>
                </div>
                <div style={{display:"flex",gap:4,flexShrink:0}}>
                  <button onClick={()=>toggleCommentStatus(c.id)} style={{padding:"3px 7px",background:isOpen?"#fef9c3":"#dcfce7",border:"none",borderRadius:4,fontSize:8.5,fontFamily:mono,color:isOpen?"#a16207":"#16653a",cursor:"pointer",fontWeight:700}}>{isOpen?"Resolve":"Reopen"}</button>
                  <button onClick={()=>deleteComment(c.id)} style={{padding:"3px 6px",background:"#fee2e2",border:"none",borderRadius:4,fontSize:8.5,fontFamily:mono,color:"#dc2626",cursor:"pointer"}}>‚úï</button>
                </div>
              </div>
            </div>;
          }))}

          {/* Custom tasks section */}
          {tasks.filter(t=>t.id>100).length>0&&<div style={{marginTop:16}}>
            <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginBottom:8}}>CUSTOM TASKS ADDED</div>
            {tasks.filter(t=>t.id>100).map(t=><TaskCard key={t.id} t={t}/>)}
          </div>}
        </div>}

        {/* ‚ïê‚ïê‚ïê REQUIREMENTS ‚ïê‚ïê‚ïê */}
        {view==="reqs"&&<div>
          <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginBottom:8}}>CLIENT-SIDE REQUIREMENTS</div>
          {requirements.map((r,i)=>(
            <div key={i} style={{display:"grid",gridTemplateColumns:"1fr 110px 65px 50px",gap:5,alignItems:"center",padding:"7px 10px",background:"#fff",border:"1px solid #e5e1dc",borderRadius:5,borderLeft:r.critical?"3px solid #dc2626":"3px solid #ddd",marginBottom:2}}>
              <span style={{fontSize:11,fontWeight:600,color:"#333"}}>{r.item}</span>
              <span style={{fontFamily:mono,fontSize:9,color:"#888"}}>{r.who}</span>
              <span style={{fontFamily:mono,fontSize:9,color:r.critical?"#dc2626":"#888",fontWeight:r.critical?700:400}}>{r.due}</span>
              {r.critical?<span style={{fontFamily:mono,fontSize:7,color:"#dc2626",background:"#fef2f2",padding:"1px 3px",borderRadius:2,fontWeight:700,textAlign:"center"}}>CRITICAL</span>:<span/>}
            </div>
          ))}
          <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginTop:14,marginBottom:8}}>CRITICAL HIRES</div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:14}}>
            {[{role:"Cost Controller",resp:"Food cost, recipe validation, variance analysis, stock-take oversight",by:"Week 1"},{role:"Chief Accountant",resp:"Consolidated P&L, financial position, bank reconciliation",by:"Week 1‚Äì2"}].map((h,i)=>(
              <div key={i} style={{background:"#fff",border:"1px solid #fca5a5",borderRadius:8,padding:"10px 12px"}}>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}>
                  <span style={{fontFamily:disp,fontSize:12,fontWeight:700}}>{h.role}</span>
                  <span style={{fontFamily:mono,fontSize:8,color:"#dc2626",fontWeight:700}}>BY {h.by.toUpperCase()}</span>
                </div>
                <div style={{fontSize:10,color:"#888",lineHeight:1.4}}>{h.resp}</div>
              </div>
            ))}
          </div>
          <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginBottom:8}}>KEY TERMS</div>
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"12px 14px"}}>
            {["Valid 30 days","Deliverables become Abou Shakra IP upon payment","Scope changes quoted as addenda","Strictly confidential","14 days notice to terminate; retainer prorated","Unimpeded access to systems & personnel required","Client delays extend timeline proportionally","Monthly retainer based on hours with EGP 100K minimum"].map((t,i)=>(
              <div key={i} style={{display:"flex",gap:5,padding:"3px 0",borderBottom:i<7?"1px solid #f0f0ee":"none"}}>
                <span style={{fontFamily:mono,fontSize:9,color:"#D4863A"}}>¬ß{i+1}</span>
                <span style={{fontSize:10.5,color:"#666",lineHeight:1.5}}>{t}</span>
              </div>
            ))}
          </div>
        </div>}

        <div style={{marginTop:20,paddingTop:12,borderTop:"1px solid #e5e1dc",display:"flex",justifyContent:"space-between"}}>
          <div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontFamily:disp,fontSize:11,fontWeight:300,color:"#bbb"}}>C^2</span><span style={{fontFamily:mono,fontSize:7.5,color:"#ccc",letterSpacing:2}}>FRACTIONAL MANAGEMENT</span></div>
          <span style={{fontFamily:mono,fontSize:7.5,color:"#ccc"}}>QT-AS-2026-001 ¬∑ Confidential</span>
        </div>
      </div>

      {/* ‚îÄ‚îÄ‚îÄ ADD TASK MODAL ‚îÄ‚îÄ‚îÄ */}
      {showAddTask&&<div className="modal-overlay" onClick={()=>setShowAddTask(false)}>
        <div className="modal-box" onClick={e=>e.stopPropagation()}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
            <div style={{fontFamily:disp,fontSize:16,fontWeight:700}}>Add Custom Task</div>
            <button onClick={()=>setShowAddTask(false)} style={{background:"none",border:"none",fontSize:18,color:"#999",cursor:"pointer"}}>‚úï</button>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
            <div style={{gridColumn:"1/-1"}}>
              <div style={labelStyle}>TASK NAME *</div>
              <input value={newTask.name} onChange={e=>setNewTask(p=>({...p,name:e.target.value}))} style={{...inputStyle,fontSize:13}} placeholder="e.g. Cash flow forecast model"/>
            </div>
            <div>
              <div style={labelStyle}>BUCKET</div>
              <select value={newTask.b} onChange={e=>setNewTask(p=>({...p,b:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                {buckets.map(b=><option key={b.id} value={b.id}>{b.id} ‚Äì {b.name}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>DEPARTMENT</div>
              <select value={newTask.dept} onChange={e=>setNewTask(p=>({...p,dept:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                {Object.entries(D).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>TIER</div>
              <select value={newTask.tier} onChange={e=>setNewTask(p=>({...p,tier:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                {Object.entries(T).map(([k,v])=><option key={k} value={k}>{v.ico} {v.l}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>PRIORITY</div>
              <select value={newTask.prio} onChange={e=>setNewTask(p=>({...p,prio:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                {Object.entries(PRIO).map(([k,v])=><option key={k} value={k}>{v.ico} {v.l}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>IMPACT</div>
              <select value={newTask.impact} onChange={e=>setNewTask(p=>({...p,impact:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                {Object.entries(IMP).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>HOURS</div>
              <input type="number" min="1" value={newTask.hrs} onChange={e=>setNewTask(p=>({...p,hrs:Number(e.target.value)}))} style={inputStyle}/>
            </div>
            <div>
              <div style={labelStyle}>WEEK START</div>
              <select value={newTask.w[0]} onChange={e=>setNewTask(p=>({...p,w:[Number(e.target.value),Math.max(Number(e.target.value),p.w[1])]}))} style={{...inputStyle,padding:"6px 7px"}}>
                {WEEKS.map(w=><option key={w} value={w}>Week {w}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>WEEK END</div>
              <select value={newTask.w[1]} onChange={e=>setNewTask(p=>({...p,w:[p.w[0],Number(e.target.value)]}))} style={{...inputStyle,padding:"6px 7px"}}>
                {WEEKS.filter(w=>w>=newTask.w[0]).map(w=><option key={w} value={w}>Week {w}</option>)}
              </select>
            </div>
            <div style={{gridColumn:"1/-1"}}>
              <div style={labelStyle}>DESCRIPTION</div>
              <textarea value={newTask.desc} onChange={e=>setNewTask(p=>({...p,desc:e.target.value}))} rows={2} style={{...inputStyle,resize:"vertical"}} placeholder="What does this task deliver?"/>
            </div>
            <div>
              <div style={labelStyle}>P&L IMPACT</div>
              <input value={newTask.pnl} onChange={e=>setNewTask(p=>({...p,pnl:e.target.value}))} style={inputStyle} placeholder="Effect on P&L"/>
            </div>
            <div>
              <div style={labelStyle}>BALANCE SHEET IMPACT</div>
              <input value={newTask.bs} onChange={e=>setNewTask(p=>({...p,bs:e.target.value}))} style={inputStyle} placeholder="Effect on BS"/>
            </div>
            <div style={{gridColumn:"1/-1"}}>
              <div style={labelStyle}>CASH FLOW IMPACT</div>
              <input value={newTask.cf} onChange={e=>setNewTask(p=>({...p,cf:e.target.value}))} style={inputStyle} placeholder="Effect on cash flow"/>
            </div>
          </div>
          <div style={{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16}}>
            <button onClick={()=>setShowAddTask(false)} style={{padding:"8px 16px",background:"#f5f3f0",border:"1px solid #e5e1dc",borderRadius:6,fontSize:12,cursor:"pointer",fontFamily:sans}}>Cancel</button>
            <button onClick={addTask} disabled={!newTask.name} style={{padding:"8px 16px",background:newTask.name?"#16653a":"#ccc",color:"#fff",border:"none",borderRadius:6,fontSize:12,fontWeight:700,cursor:newTask.name?"pointer":"default",fontFamily:sans}}>Add Task</button>
          </div>
        </div>
      </div>}

      {/* ‚îÄ‚îÄ‚îÄ ADD COMMENT MODAL ‚îÄ‚îÄ‚îÄ */}
      {showAddComment&&<div className="modal-overlay" onClick={()=>setShowAddComment(false)}>
        <div className="modal-box" onClick={e=>e.stopPropagation()}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
            <div style={{fontFamily:disp,fontSize:16,fontWeight:700}}>Add Comment / Action Item</div>
            <button onClick={()=>setShowAddComment(false)} style={{background:"none",border:"none",fontSize:18,color:"#999",cursor:"pointer"}}>‚úï</button>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
            <div>
              <div style={labelStyle}>YOUR NAME *</div>
              <input value={newComment.author} onChange={e=>setNewComment(p=>({...p,author:e.target.value}))} style={inputStyle} placeholder="e.g. Ahmed / Moustafa"/>
            </div>
            <div>
              <div style={labelStyle}>TYPE</div>
              <select value={newComment.type} onChange={e=>setNewComment(p=>({...p,type:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                <option value="comment">üí¨ Comment</option>
                <option value="action">‚úÖ Action Item</option>
                <option value="risk">‚ö†Ô∏è Risk / Blocker</option>
                <option value="decision">üéØ Decision</option>
              </select>
            </div>
            <div style={{gridColumn:"1/-1"}}>
              <div style={labelStyle}>CONTENT *</div>
              <textarea value={newComment.content} onChange={e=>setNewComment(p=>({...p,content:e.target.value}))} rows={3} style={{...inputStyle,resize:"vertical"}} placeholder="What needs to be noted or actioned?"/>
            </div>
            <div>
              <div style={labelStyle}>RELATED TASK (OPTIONAL)</div>
              <select value={newComment.task} onChange={e=>setNewComment(p=>({...p,task:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                <option value="">‚Äî None ‚Äî</option>
                {tasks.map(t=><option key={t.id} value={`#${t.id} ${t.name}`}>#{t.id} {t.name}</option>)}
              </select>
            </div>
            <div>
              <div style={labelStyle}>STATUS</div>
              <select value={newComment.status} onChange={e=>setNewComment(p=>({...p,status:e.target.value}))} style={{...inputStyle,padding:"6px 7px"}}>
                <option value="Open">Open</option>
                <option value="Resolved">Resolved</option>
              </select>
            </div>
          </div>
          <div style={{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16}}>
            <button onClick={()=>setShowAddComment(false)} style={{padding:"8px 16px",background:"#f5f3f0",border:"1px solid #e5e1dc",borderRadius:6,fontSize:12,cursor:"pointer",fontFamily:sans}}>Cancel</button>
            <button onClick={addComment} disabled={!newComment.author||!newComment.content} style={{padding:"8px 16px",background:(newComment.author&&newComment.content)?"#1e40af":"#ccc",color:"#fff",border:"none",borderRadius:6,fontSize:12,fontWeight:700,cursor:(newComment.author&&newComment.content)?"pointer":"default",fontFamily:sans}}>Add</button>
          </div>
        </div>
      </div>}

        {/* ‚ïê‚ïê‚ïê MARKETING & FUNNELS ‚ïê‚ïê‚ïê */}
        {view==="marketing"&&<div>
          <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginBottom:8}}>MARKETING & SALES FUNNELS</div>

          {/* Funnel Overview Cards */}
          <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",gap:10,marginBottom:16}}>
            {[
              {label:"Awareness",icon:"üì¢",channels:["Social Media (IG/TikTok)","Google Ads","Influencer Partnerships","PR & Press"],color:"#1e40af",bg:"#eff6ff",kpi:"Reach & Impressions",target:"500K+/month"},
              {label:"Consideration",icon:"üîç",channels:["Google My Business","Menu on Talabat/Noon","Website & SEO","Reviews & Ratings"],color:"#a16207",bg:"#fffbeb",kpi:"Profile Views & Clicks",target:"50K+/month"},
              {label:"Conversion",icon:"üõí",channels:["Promotions & Offers","Loyalty Programme","Direct Reservations","QC Platform Orders"],color:"#16653a",bg:"#f0fdf4",kpi:"Orders & Covers",target:"Avg check EGP 250+"},
              {label:"Retention",icon:"üíõ",channels:["CRM & WhatsApp","Loyalty Points","Birthday/Anniversary","Staff Recognition"],color:"#7c3aed",bg:"#faf5ff",kpi:"Repeat Visit Rate",target:"40%+ repeat customers"},
            ].map((f,i)=>(
              <div key={i} style={{background:f.bg,border:`1px solid`,borderColor:f.color+"33",borderLeft:`4px solid ${f.color}`,borderRadius:8,padding:"12px 14px"}}>
                <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:8}}>
                  <span style={{fontSize:18}}>{f.icon}</span>
                  <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:f.color}}>{f.label}</div>
                </div>
                {f.channels.map((c,j)=><div key={j} style={{fontFamily:sans,fontSize:10.5,color:"#555",padding:"2px 0",borderBottom:"1px solid #f0ede8"}}>‚Ä¢ {c}</div>)}
                <div style={{marginTop:8,display:"flex",justifyContent:"space-between"}}>
                  <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1}}>{f.kpi}</div>
                  <div style={{fontFamily:mono,fontSize:9,color:f.color,fontWeight:700}}>{f.target}</div>
                </div>
              </div>
            ))}
          </div>

          {/* Channel Mix & Budget */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:10}}>Recommended Channel Mix & Budget Allocation</div>
            <div style={{overflowX:"auto"}}>
              <table style={{width:"100%",borderCollapse:"collapse",fontFamily:sans,fontSize:11}}>
                <thead>
                  <tr style={{background:"#f5f3f0"}}>
                    {["Channel","Type","Monthly Budget (EGP)","Expected Reach","Primary KPI","ROI Potential"].map((h,i)=>(
                      <th key={i} style={{padding:"6px 10px",textAlign:"left",fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1,borderBottom:"1px solid #e5e1dc",fontWeight:600}}>{h}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {[
                    ["Instagram / TikTok Ads","Paid Social","15,000‚Äì25,000","80K‚Äì200K users","Reach, Saves, Profile visits","3‚Äì5x"],
                    ["Google Ads (Search+Maps)","Paid Search","10,000‚Äì20,000","20K‚Äì60K searches","Clicks, Direction requests","4‚Äì7x"],
                    ["Influencer Marketing","Earned/Paid","10,000‚Äì30,000","50K‚Äì500K views","Impressions, New followers","2‚Äì4x"],
                    ["Talabat / Noon Ads","Platform Promo","8,000‚Äì15,000","30K‚Äì100K views","Orders, GMV","5‚Äì10x"],
                    ["Google My Business","Organic","0 (time only)","10K‚Äì30K searches","Reviews, Directions","High"],
                    ["Email / WhatsApp CRM","Retention","3,000‚Äì5,000","Existing base","Open rate, Repeat visits","8‚Äì15x"],
                    ["PR & Press","Earned","5,000‚Äì10,000","Broad","Brand mentions","Hard to measure"],
                  ].map((row,i)=>(
                    <tr key={i} style={{borderBottom:"1px solid #f0ede8",background:i%2===0?"#fff":"#fafaf8"}}>
                      {row.map((cell,j)=>(
                        <td key={j} style={{padding:"7px 10px",color:j===0?"#222":"#555",fontWeight:j===0?600:400}}>{cell}</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Sales Funnel Metrics */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:10}}>Sales Funnel Conversion Benchmarks ‚Äî F&B Egypt</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:8}}>
              {[
                {stage:"Impressions ‚Üí Profile Visit",benchmark:"2‚Äì5%",target:"4%+",color:"#1e40af"},
                {stage:"Profile Visit ‚Üí Menu View",benchmark:"30‚Äì50%",target:"45%+",color:"#a16207"},
                {stage:"Menu View ‚Üí Order/Reservation",benchmark:"5‚Äì15%",target:"12%+",color:"#16653a"},
                {stage:"First Visit ‚Üí Repeat Visit",benchmark:"20‚Äì35%",target:"40%+",color:"#7c3aed"},
                {stage:"Repeat ‚Üí Loyal (5+ visits)",benchmark:"10‚Äì20%",target:"20%+",color:"#be185d"},
                {stage:"Avg Order Value Growth",benchmark:"Market flat",target:"+15% YoY",color:"#dc2626"},
              ].map((m,i)=>(
                <div key={i} style={{background:"#f9f8f6",borderRadius:6,padding:"10px 12px",borderLeft:`3px solid ${m.color}`}}>
                  <div style={{fontFamily:sans,fontSize:10,color:"#666",marginBottom:4}}>{m.stage}</div>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <div><div style={{fontFamily:mono,fontSize:7.5,color:"#999",letterSpacing:1}}>BENCHMARK</div><div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:"#888"}}>{m.benchmark}</div></div>
                    <div style={{textAlign:"right"}}><div style={{fontFamily:mono,fontSize:7.5,color:"#999",letterSpacing:1}}>OUR TARGET</div><div style={{fontFamily:disp,fontSize:14,fontWeight:700,color:m.color}}>{m.target}</div></div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Marketing Action Plan */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px"}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:10}}>90-Day Marketing Action Plan</div>
            {[
              {phase:"Month 1 ‚Äî Audit & Foundation",color:"#dc2626",items:[
                "Audit existing social accounts, GMB listings, and review profiles across all 8 branches",
                "Standardise brand assets: logo, photography style, menu photography (all branches)",
                "Set up CRM / WhatsApp broadcast list from existing customer database",
                "Claim and optimise all Google My Business listings ‚Äî photos, hours, menus",
                "Benchmark current baseline: followers, ratings, monthly orders per channel",
              ]},
              {phase:"Month 2 ‚Äî Activate & Test",color:"#a16207",items:[
                "Launch paid social campaigns (IG/TikTok) ‚Äî 2-week test per branch, EGP 5K budget",
                "Run Google Ads for top 3 revenue branches ‚Äî search + maps",
                "Activate Talabat/Noon promotional placements for quick commerce revenue push",
                "Onboard 2 micro-influencers per branch (10K‚Äì100K followers, food niche)",
                "Launch WhatsApp loyalty broadcast ‚Äî weekly deal to existing customers",
              ]},
              {phase:"Month 3 ‚Äî Optimise & Scale",color:"#16653a",items:[
                "Analyse Month 1‚Äì2 data: identify top-performing channels per branch",
                "Reallocate budget to highest-ROI channels; cut underperformers",
                "Launch referral programme: 'Bring a friend, get X% off' across branches",
                "Introduce seasonal/Ramadan campaign if timing aligns",
                "Report: revenue attributable to marketing vs. baseline",
              ]},
            ].map((ph,i)=>(
              <div key={i} style={{marginBottom:12,borderLeft:`3px solid ${ph.color}`,paddingLeft:12}}>
                <div style={{fontFamily:disp,fontSize:12,fontWeight:700,color:ph.color,marginBottom:6}}>{ph.phase}</div>
                {ph.items.map((item,j)=>(
                  <div key={j} style={{fontFamily:sans,fontSize:10.5,color:"#555",padding:"3px 0",display:"flex",gap:6}}>
                    <span style={{color:ph.color,fontWeight:700,flexShrink:0}}>‚Üí</span>{item}
                  </div>
                ))}
              </div>
            ))}
          </div>
        </div>}

        {/* ‚ïê‚ïê‚ïê SALES INCENTIVES ‚ïê‚ïê‚ïê */}
        {view==="incentive"&&<div>
          <div style={{fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1.5,marginBottom:8}}>SALES TEAM INCENTIVE SCHEME</div>

          {/* Philosophy */}
          <div style={{background:"#fff",border:"1px solid #fecaca",borderLeft:"4px solid #dc2626",borderRadius:8,padding:"12px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#dc2626",marginBottom:4}}>Design Philosophy</div>
            <div style={{fontFamily:sans,fontSize:11,color:"#444",lineHeight:1.6}}>Incentives must drive <strong>revenue growth</strong>, <strong>margin protection</strong>, and <strong>repeat customer behaviour</strong> ‚Äî not just covers or top-line sales. Every scheme here ties individual performance to branch-level EBITDA improvement, preventing the trap of high revenue at poor margin.</div>
          </div>

          {/* Roles & Tiers */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:10}}>Role Tiers & Base Commission Structure</div>
            <div style={{overflowX:"auto"}}>
              <table style={{width:"100%",borderCollapse:"collapse",fontFamily:sans,fontSize:11}}>
                <thead>
                  <tr style={{background:"#f5f3f0"}}>
                    {["Role","Base Salary Range","Commission Base","Accelerator (110%+ target)","Accelerator (125%+ target)","Cap"].map((h,i)=>(
                      <th key={i} style={{padding:"6px 10px",textAlign:"left",fontFamily:mono,fontSize:8,color:"#999",letterSpacing:1,borderBottom:"1px solid #e5e1dc",fontWeight:600}}>{h}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {[
                    ["Branch Manager","EGP 8,000‚Äì14,000","2% of branch EBITDA improvement","2.5% (bonus tier)","3.5% (stretch tier)","EGP 25,000/month"],
                    ["Floor Supervisor","EGP 5,000‚Äì8,000","1% of branch revenue above target","1.25%","1.75%","EGP 12,000/month"],
                    ["Waiter / Service Staff","EGP 3,000‚Äì5,000","EGP 50 per table above EGP 300 avg check","EGP 75/table","EGP 100/table","EGP 6,000/month"],
                    ["QC Coordinator (Delivery)","EGP 4,000‚Äì6,000","0.5% of QC revenue above target","0.75%","1%","EGP 8,000/month"],
                    ["Reservations / Host","EGP 3,500‚Äì5,500","EGP 25/cover for pre-booked tables","EGP 35/cover","EGP 50/cover","EGP 5,000/month"],
                    ["Sales Manager (Central)","EGP 12,000‚Äì18,000","1.5% of total revenue above group target","2%","3%","EGP 30,000/month"],
                  ].map((row,i)=>(
                    <tr key={i} style={{borderBottom:"1px solid #f0ede8",background:i%2===0?"#fff":"#fafaf8"}}>
                      {row.map((cell,j)=>(
                        <td key={j} style={{padding:"7px 10px",color:j===0?"#222":"#555",fontWeight:j===0?600:400}}>{cell}</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* KPI Bonuses */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:10}}>KPI-Based Bonus Triggers</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))",gap:8}}>
              {[
                {kpi:"Average Check Uplift",desc:"Branch avg check grows ‚â• 10% vs prior month",bonus:"EGP 2,000 per branch manager",icon:"üìà",color:"#16653a"},
                {kpi:"Food Cost Below Target",desc:"Branch FC% ‚â§ target for 2 consecutive months",bonus:"EGP 3,000 per branch manager",icon:"üçΩ",color:"#a16207"},
                {kpi:"Customer Review Score",desc:"Google rating reaches 4.5+ or improves by 0.3",bonus:"EGP 1,500 team bonus (split equally)",icon:"‚≠ê",color:"#ca8a04"},
                {kpi:"Upsell Rate",desc:"Dessert/drink attach rate ‚â• 40% of dine-in covers",bonus:"EGP 100/waiter per week at target",icon:"ü•Ç",color:"#7c3aed"},
                {kpi:"Zero Shrinkage Month",desc:"Stock variance < 0.5% for the month",bonus:"EGP 2,500 ops team bonus",icon:"üì¶",color:"#1e40af"},
                {kpi:"QC Order Growth",desc:"QC revenue grows ‚â• 15% month-on-month",bonus:"EGP 1,500 QC coordinator bonus",icon:"üõµ",color:"#be185d"},
                {kpi:"Loyalty Sign-ups",desc:"‚â• 50 new loyalty members registered in the month",bonus:"EGP 500 host/reservations bonus",icon:"üíõ",color:"#dc2626"},
                {kpi:"Repeat Visit Rate",desc:"Measurable repeat customer rate ‚â• 35%",bonus:"EGP 1,000 floor team bonus",icon:"üîÑ",color:"#0f766e"},
              ].map((b,i)=>(
                <div key={i} style={{background:"#f9f8f6",borderRadius:6,padding:"10px 12px",borderLeft:`3px solid ${b.color}`}}>
                  <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:4}}>
                    <span style={{fontSize:16}}>{b.icon}</span>
                    <div style={{fontFamily:disp,fontSize:11,fontWeight:700,color:b.color}}>{b.kpi}</div>
                  </div>
                  <div style={{fontFamily:sans,fontSize:10,color:"#666",marginBottom:6}}>{b.desc}</div>
                  <div style={{fontFamily:mono,fontSize:9,color:b.color,fontWeight:700}}>{b.bonus}</div>
                </div>
              ))}
            </div>
          </div>

          {/* Leaderboard Structure */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px",marginBottom:12}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:10}}>Monthly Branch Leaderboard ‚Äî Competition Structure</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:10,marginBottom:12}}>
              {[
                {rank:"ü•á 1st Place",prize:"EGP 10,000 team bonus + Trophy + Group recognition",bg:"#fef9c3",bdr:"#ca8a04"},
                {rank:"ü•à 2nd Place",prize:"EGP 5,000 team bonus + Certificate",bg:"#f1f5f9",bdr:"#94a3b8"},
                {rank:"ü•â 3rd Place",prize:"EGP 2,500 team bonus + Recognition",bg:"#fff7ed",bdr:"#c2410c"},
              ].map((r,i)=>(
                <div key={i} style={{background:r.bg,border:`1px solid ${r.bdr}`,borderRadius:8,padding:"12px 14px",textAlign:"center"}}>
                  <div style={{fontFamily:disp,fontSize:14,fontWeight:700,marginBottom:6}}>{r.rank}</div>
                  <div style={{fontFamily:sans,fontSize:10.5,color:"#555"}}>{r.prize}</div>
                </div>
              ))}
            </div>
            <div style={{fontFamily:sans,fontSize:11,color:"#555",marginBottom:8}}><strong>Scoring formula:</strong> Each branch scored monthly across 5 weighted metrics:</div>
            {[
              ["Revenue vs Target",25],
              ["EBITDA Margin",30],
              ["Average Check vs Target",15],
              ["Customer Rating (Google/Talabat)",15],
              ["Food Cost % vs Target",15],
            ].map(([metric,weight],i)=>(
              <div key={i} style={{display:"flex",alignItems:"center",gap:8,marginBottom:5}}>
                <div style={{fontFamily:sans,fontSize:10.5,color:"#444",width:220,flexShrink:0}}>{metric}</div>
                <div style={{flex:1,background:"#f0ede8",borderRadius:4,height:8,overflow:"hidden"}}>
                  <div style={{width:`${weight*4}%`,height:"100%",background:"#D4863A",borderRadius:4}}/>
                </div>
                <div style={{fontFamily:mono,fontSize:9,color:"#D4863A",fontWeight:700,width:40,textAlign:"right"}}>{weight}%</div>
              </div>
            ))}
          </div>

          {/* Guardrails */}
          <div style={{background:"#fff",border:"1px solid #e5e1dc",borderRadius:8,padding:"14px 16px"}}>
            <div style={{fontFamily:disp,fontSize:13,fontWeight:700,color:"#222",marginBottom:8}}>Scheme Guardrails & Anti-Gaming Rules</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(250px,1fr))",gap:8}}>
              {[
                {rule:"Commission only paid if branch FC% ‚â§ target",reason:"Prevents revenue chasing at margin expense",icon:"üîí"},
                {rule:"No bonus if shrinkage > 2% that month",reason:"Protects inventory integrity",icon:"üîí"},
                {rule:"Avg check target resets monthly (no sandbagging)",reason:"Prevents holding back performance",icon:"üîí"},
                {rule:"QC commissions net of platform fees",reason:"Commissions on actual realised revenue only",icon:"üîí"},
                {rule:"Disputes reviewed by C¬≤ + CFO jointly",reason:"Independent verification prevents manipulation",icon:"üîí"},
                {rule:"All bonuses paid on 15th of following month",reason:"Aligns with P&L close and verification",icon:"üîí"},
              ].map((g,i)=>(
                <div key={i} style={{display:"flex",gap:8,padding:"8px 10px",background:"#f9f8f6",borderRadius:6,alignItems:"flex-start"}}>
                  <span style={{fontSize:14,flexShrink:0}}>{g.icon}</span>
                  <div>
                    <div style={{fontFamily:sans,fontSize:10.5,fontWeight:600,color:"#222",marginBottom:2}}>{g.rule}</div>
                    <div style={{fontFamily:sans,fontSize:9.5,color:"#888"}}>{g.reason}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>}

      </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(App));
</script>
</body>
</html>
